
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.3">
    
    
      
        <title>Agents - Ray</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.edf004c2.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../css/termynal.css">
    
      <link rel="stylesheet" href="../../../css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#agents-package" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
        </aside>
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://ray.io" title="Ray" class="md-header__button md-logo" aria-label="Ray" data-md-component="logo">
      
  <img src="../../../images/ray-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ray
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Agents
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="red"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ray-project/ray" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ray-project/ray
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        Getting Started
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../ray-deployment/" class="md-tabs__link">
        Deploying Ray
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../ray-ecosystem/" class="md-tabs__link">
        Ecosystem
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../ray-examples/" class="md-tabs__link">
        Examples
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../" class="md-tabs__link md-tabs__link--active">
        API
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../ray-contributor-guide/" class="md-tabs__link">
        Contribute
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://ray.io" title="Ray" class="md-nav__button md-logo" aria-label="Ray" data-md-component="logo">
      
  <img src="../../../images/ray-logo.png" alt="logo">

    </a>
    Ray
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ray-project/ray" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ray-project/ray
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../..">Getting Started</a>
          
            <label for="__nav_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-overview/what-and-why-ray/" class="md-nav__link">
        Why Ray?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-overview/more-information/" class="md-nav__link">
        Learn more
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_4" type="checkbox" id="__nav_1_4" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../ray-core/">Ray Core</a>
          
            <label for="__nav_1_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Ray Core" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_4">
          <span class="md-nav__icon md-icon"></span>
          Ray Core
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-core/key-concepts/" class="md-nav__link">
        Key concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-core/tutorials/" class="md-nav__link">
        Tutorials
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_5" type="checkbox" id="__nav_1_5" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../ray-ml/ray-data/">Ray Data</a>
          
            <label for="__nav_1_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Ray Data" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_5">
          <span class="md-nav__icon md-icon"></span>
          Ray Data
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-ml/ray-data/key-concepts/" class="md-nav__link">
        Key concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_5_3" type="checkbox" id="__nav_1_5_3" >
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../ray-ml/ray-data/tutorials/">Tutorials</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Tutorials" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_5_3">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_6" type="checkbox" id="__nav_1_6" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../ray-ml/ray-train/">Ray Train</a>
          
            <label for="__nav_1_6">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Ray Train" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_6">
          <span class="md-nav__icon md-icon"></span>
          Ray Train
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-ml/ray-train/key-concepts/" class="md-nav__link">
        Key concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-ml/ray-train/tutorials/" class="md-nav__link">
        Tutorials
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_7" type="checkbox" id="__nav_1_7" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../ray-ml/ray-rllib/">Ray RLlib</a>
          
            <label for="__nav_1_7">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Ray RLlib" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_7">
          <span class="md-nav__icon md-icon"></span>
          Ray RLlib
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-ml/ray-rllib/key-concepts/" class="md-nav__link">
        Key concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-ml/ray-rllib/tutorials/" class="md-nav__link">
        Tutorials
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_8" type="checkbox" id="__nav_1_8" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../ray-ml/ray-tune/">Ray Tune</a>
          
            <label for="__nav_1_8">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Ray Tune" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_8">
          <span class="md-nav__icon md-icon"></span>
          Ray Tune
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-ml/ray-tune/key-concepts/" class="md-nav__link">
        Key concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-ml/ray-tune/tutorials/" class="md-nav__link">
        Tutorials
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_9" type="checkbox" id="__nav_1_9" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../ray-ml/ray-serve/">Ray Serve</a>
          
            <label for="__nav_1_9">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Ray Serve" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_9">
          <span class="md-nav__icon md-icon"></span>
          Ray Serve
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-ml/ray-serve/key-concepts/" class="md-nav__link">
        Key concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_9_3" type="checkbox" id="__nav_1_9_3" >
      
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../ray-ml/ray-serve/tutorials/">Tutorials</a>
          
            <label for="__nav_1_9_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Tutorials" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_9_3">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-ml/ray-serve/tutorials/model-composition/" class="md-nav__link">
        Model composition
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_10" type="checkbox" id="__nav_1_10" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../ray-ml/ray-workflows/">Ray Workflows</a>
          
            <label for="__nav_1_10">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Ray Workflows" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_10">
          <span class="md-nav__icon md-icon"></span>
          Ray Workflows
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-ml/ray-workflows/key-concepts/" class="md-nav__link">
        Key concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-ml/ray-workflows/tutorials/" class="md-nav__link">
        Tutorials
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../ray-deployment/">Deploying Ray</a>
          
            <label for="__nav_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Deploying Ray" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Deploying Ray
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-deployment/key-concepts/" class="md-nav__link">
        Key concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-deployment/tutorials/" class="md-nav__link">
        Tutorials
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../ray-ecosystem/">Ecosystem</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Ecosystem" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Ecosystem
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-ecosystem/integrations/integrations/" class="md-nav__link">
        Integrations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-ecosystem/integrations/joblib/" class="md-nav__link">
        Joblib
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../ray-examples/">Examples</a>
          
            <label for="__nav_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Examples" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_2">
          Crash Course
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Crash Course" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Crash Course
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-examples/ray-crash-course/00-Ray-Crash-Course-Overview/" class="md-nav__link">
        Ray "Crash Course" Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-examples/ray-crash-course/01-Ray-Tasks/" class="md-nav__link">
        Ray Crash Course - Tasks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-examples/ray-crash-course/02-Ray-Actors/" class="md-nav__link">
        Ray Crash Course - Actors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-examples/ray-crash-course/03-Why-Ray/" class="md-nav__link">
        Ray Crash Course - Why Ray?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-examples/ray-crash-course/04-Ray-Multiprocessing/" class="md-nav__link">
        Ray Crash Course - Python Multiprocessing with Ray
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-examples/ray-crash-course/05-Ray-Parallel-Iterators/" class="md-nav__link">
        Ray Crash Course - Ray Parallel Iterators (Now deprecated in Ray 1.7)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-examples/ray-crash-course/06-Exploring-Ray-API-Calls/" class="md-nav__link">
        Ray Crash Course - Exploring Ray API Calls
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-examples/ray-crash-course/07-Running-Ray-Clusters/" class="md-nav__link">
        Ray Crash Course - Ray Clusters and the Ray CLI
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../">API</a>
          
            <label for="__nav_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="API" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_2" type="checkbox" id="__nav_5_2" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../">Ray RLlib</a>
          
            <label for="__nav_5_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Ray RLlib" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          Ray RLlib
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Agents
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Agents
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer" class="md-nav__link">
    Trainer
  </a>
  
    <nav class="md-nav" aria-label="Trainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.add_policy" class="md-nav__link">
    add_policy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.cleanup" class="md-nav__link">
    cleanup()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.collect_metrics" class="md-nav__link">
    collect_metrics()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.compute_actions" class="md-nav__link">
    compute_actions()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.compute_single_action" class="md-nav__link">
    compute_single_action()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.default_resource_request" class="md-nav__link">
    default_resource_request()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.evaluate" class="md-nav__link">
    evaluate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.export_policy_checkpoint" class="md-nav__link">
    export_policy_checkpoint()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.export_policy_model" class="md-nav__link">
    export_policy_model()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.get_default_policy_class" class="md-nav__link">
    get_default_policy_class()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.get_policy" class="md-nav__link">
    get_policy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.get_weights" class="md-nav__link">
    get_weights()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.import_model" class="md-nav__link">
    import_model()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.import_policy_model_from_h5" class="md-nav__link">
    import_policy_model_from_h5()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.load_checkpoint" class="md-nav__link">
    load_checkpoint()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.log_result" class="md-nav__link">
    log_result()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.remove_policy" class="md-nav__link">
    remove_policy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.resource_help" class="md-nav__link">
    resource_help()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.save_checkpoint" class="md-nav__link">
    save_checkpoint()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.set_weights" class="md-nav__link">
    set_weights()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.setup" class="md-nav__link">
    setup()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.step" class="md-nav__link">
    step()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.step_attempt" class="md-nav__link">
    step_attempt()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.try_recover_from_step_attempt" class="md-nav__link">
    try_recover_from_step_attempt()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.validate_env" class="md-nav__link">
    validate_env()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ray.rllib.agents.callbacks.DefaultCallbacks" class="md-nav__link">
    DefaultCallbacks
  </a>
  
    <nav class="md-nav" aria-label="DefaultCallbacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.callbacks.DefaultCallbacks.on_episode_end" class="md-nav__link">
    on_episode_end()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.callbacks.DefaultCallbacks.on_episode_start" class="md-nav__link">
    on_episode_start()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.callbacks.DefaultCallbacks.on_episode_step" class="md-nav__link">
    on_episode_step()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.callbacks.DefaultCallbacks.on_learn_on_batch" class="md-nav__link">
    on_learn_on_batch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.callbacks.DefaultCallbacks.on_postprocess_trajectory" class="md-nav__link">
    on_postprocess_trajectory()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.callbacks.DefaultCallbacks.on_sample_end" class="md-nav__link">
    on_sample_end()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.callbacks.DefaultCallbacks.on_train_result" class="md-nav__link">
    on_train_result()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../policy/" class="md-nav__link">
        Policies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../env/" class="md-nav__link">
        Environments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        Models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../evaluation/" class="md-nav__link">
        Evaluation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../execution/" class="md-nav__link">
        Execution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        Utility
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ray-core/" class="md-nav__link">
        Ray Core
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ray-data/" class="md-nav__link">
        Ray Data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ray-train/" class="md-nav__link">
        Ray Train
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ray-tune/" class="md-nav__link">
        Ray Tune
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ray-workflows/" class="md-nav__link">
        Ray Workflows
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ray-serve/" class="md-nav__link">
        Ray Serve
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../ray-contributor-guide/">Contribute</a>
          
            <label for="__nav_6">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Contribute" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Contribute
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-contributor-guide/getting-involved/" class="md-nav__link">
        Start Contributing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-contributor-guide/installing-ray/building-ray-on-linux-and-macos/" class="md-nav__link">
        Building Ray on Linux and macOS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ray-contributor-guide/installing-ray/building-ray-on-windows/" class="md-nav__link">
        Building Ray on Windows
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer" class="md-nav__link">
    Trainer
  </a>
  
    <nav class="md-nav" aria-label="Trainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.add_policy" class="md-nav__link">
    add_policy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.cleanup" class="md-nav__link">
    cleanup()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.collect_metrics" class="md-nav__link">
    collect_metrics()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.compute_actions" class="md-nav__link">
    compute_actions()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.compute_single_action" class="md-nav__link">
    compute_single_action()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.default_resource_request" class="md-nav__link">
    default_resource_request()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.evaluate" class="md-nav__link">
    evaluate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.export_policy_checkpoint" class="md-nav__link">
    export_policy_checkpoint()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.export_policy_model" class="md-nav__link">
    export_policy_model()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.get_default_policy_class" class="md-nav__link">
    get_default_policy_class()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.get_policy" class="md-nav__link">
    get_policy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.get_weights" class="md-nav__link">
    get_weights()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.import_model" class="md-nav__link">
    import_model()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.import_policy_model_from_h5" class="md-nav__link">
    import_policy_model_from_h5()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.load_checkpoint" class="md-nav__link">
    load_checkpoint()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.log_result" class="md-nav__link">
    log_result()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.remove_policy" class="md-nav__link">
    remove_policy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.resource_help" class="md-nav__link">
    resource_help()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.save_checkpoint" class="md-nav__link">
    save_checkpoint()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.set_weights" class="md-nav__link">
    set_weights()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.setup" class="md-nav__link">
    setup()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.step" class="md-nav__link">
    step()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.step_attempt" class="md-nav__link">
    step_attempt()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.try_recover_from_step_attempt" class="md-nav__link">
    try_recover_from_step_attempt()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.trainer.Trainer.validate_env" class="md-nav__link">
    validate_env()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ray.rllib.agents.callbacks.DefaultCallbacks" class="md-nav__link">
    DefaultCallbacks
  </a>
  
    <nav class="md-nav" aria-label="DefaultCallbacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.callbacks.DefaultCallbacks.on_episode_end" class="md-nav__link">
    on_episode_end()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.callbacks.DefaultCallbacks.on_episode_start" class="md-nav__link">
    on_episode_start()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.callbacks.DefaultCallbacks.on_episode_step" class="md-nav__link">
    on_episode_step()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.callbacks.DefaultCallbacks.on_learn_on_batch" class="md-nav__link">
    on_learn_on_batch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.callbacks.DefaultCallbacks.on_postprocess_trajectory" class="md-nav__link">
    on_postprocess_trajectory()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.callbacks.DefaultCallbacks.on_sample_end" class="md-nav__link">
    on_sample_end()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray.rllib.agents.callbacks.DefaultCallbacks.on_train_result" class="md-nav__link">
    on_train_result()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="agents-package"><code>agents</code> package</h1>


  <div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer">
        <code>
ray.rllib.agents.trainer.Trainer            (<span title="ray.tune.trainable.Trainable">Trainable</span>)
        </code>



</h2>

    <div class="doc doc-contents first">

      <p>An RLlib algorithm responsible for optimizing one or more Policies.</p>
<p>Trainers contain a WorkerSet under <code>self.workers</code>. A WorkerSet is
normally composed of a single local worker
(self.workers.local_worker()), used to compute and apply learning updates,
and optionally one or more remote workers (self.workers.remote_workers()),
used to generate environment samples in parallel.</p>
<p>Each worker (remotes or local) contains a PolicyMap, which itself
may contain either one policy for single-agent training or one or more
policies for multi-agent training. Policies are synchronized
automatically from time to time using ray.remote calls. The exact
synchronization logic depends on the specific algorithm (Trainer) used,
but this usually happens from local worker to all remote workers and
after each training update.</p>
<p>You can write your own Trainer sub-classes by using the
rllib.agents.trainer_template.py::build_trainer() utility function.
This allows you to provide a custom <code>execution_plan</code>. You can find the
different built-in algorithms' execution plans in their respective main
py files, e.g. rllib.agents.dqn.dqn.py or rllib.agents.impala.impala.py.</p>
<p>The most important API methods a Trainer exposes are <code>train()</code>,
<code>evaluate()</code>, <code>save()</code> and <code>restore()</code>. Trainer objects retain internal
model state between calls to train(), so you should create a new
Trainer instance for each training session.</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger_creator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remote_checkpoint_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sync_function_tpl</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>Initializes a Trainer instance.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>config</code></td>
        <td><code>Optional[dict]</code></td>
        <td><p>Algorithm-specific configuration dict.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>env</code></td>
        <td><code>Union[str, Any]</code></td>
        <td><p>Name of the environment to use (e.g. a gym-registered str),
a full class path (e.g.
"ray.rllib.examples.env.random_env.RandomEnv"), or an Env
class directly. Note that this arg can also be specified via
the "env" key in <code>config</code>.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>logger_creator</code></td>
        <td><code>Optional[Callable[[], ray.tune.logger.Logger]]</code></td>
        <td><p>Callable that creates a ray.tune.Logger
object. If unspecified, a default logger is created.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@PublicAPI</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>             <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PartialTrainerConfigDict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>             <span class="n">env</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">EnvType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>             <span class="n">logger_creator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[],</span> <span class="n">Logger</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>             <span class="n">remote_checkpoint_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>             <span class="n">sync_function_tpl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>    <span class="sd">&quot;&quot;&quot;Initializes a Trainer instance.</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">        config: Algorithm-specific configuration dict.</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">        env: Name of the environment to use (e.g. a gym-registered str),</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">            a full class path (e.g.</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">            &quot;ray.rllib.examples.env.random_env.RandomEnv&quot;), or an Env</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">            class directly. Note that this arg can also be specified via</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">            the &quot;env&quot; key in `config`.</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">        logger_creator: Callable that creates a ray.tune.Logger</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">            object. If unspecified, a default logger is created.</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="c1"># User provided (partial) config (this may be w/o the default</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="c1"># Trainer&#39;s `COMMON_CONFIG` (see above)). Will get merged with</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="c1"># COMMON_CONFIG in self.setup().</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="p">{}</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="c1"># Trainers allow env ids to be passed directly to the constructor.</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_env_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_register_if_needed</span><span class="p">(</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>        <span class="n">env</span> <span class="ow">or</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;env&quot;</span><span class="p">),</span> <span class="n">config</span><span class="p">)</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="c1"># The env creator callable, taking an EnvContext (config dict)</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="c1"># as arg and returning an RLlib supported Env type (e.g. a gym.Env).</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">env_creator</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">EnvContext</span><span class="p">],</span> <span class="n">EnvType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="c1"># Placeholder for a local replay buffer instance.</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">local_replay_buffer</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="c1"># Create a default logger creator if no logger_creator is specified</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="k">if</span> <span class="n">logger_creator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="c1"># Default logdir prefix containing the agent&#39;s name and the</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="c1"># env id.</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="n">timestr</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H-%M-%S&quot;</span><span class="p">)</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="n">logdir_prefix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env_id</span><span class="p">,</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>                                          <span class="n">timestr</span><span class="p">)</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">DEFAULT_RESULTS_DIR</span><span class="p">):</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">DEFAULT_RESULTS_DIR</span><span class="p">)</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="n">logdir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>            <span class="n">prefix</span><span class="o">=</span><span class="n">logdir_prefix</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">DEFAULT_RESULTS_DIR</span><span class="p">)</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="c1"># Allow users to more precisely configure the created logger</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="c1"># via &quot;logger_config.type&quot;.</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>                <span class="s2">&quot;logger_config&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;type&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;logger_config&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>            <span class="k">def</span> <span class="nf">default_logger_creator</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>                <span class="sd">&quot;&quot;&quot;Creates a custom logger with the default prefix.&quot;&quot;&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>                <span class="n">cfg</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;logger_config&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>                <span class="bp">cls</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>                <span class="c1"># Provide default for logdir, in case the user does</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>                <span class="c1"># not specify this in the &quot;logger_config&quot; dict.</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>                <span class="n">logdir_</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;logdir&quot;</span><span class="p">,</span> <span class="n">logdir</span><span class="p">)</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>                <span class="k">return</span> <span class="n">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="n">_args</span><span class="o">=</span><span class="p">[</span><span class="n">cfg</span><span class="p">],</span> <span class="n">logdir</span><span class="o">=</span><span class="n">logdir_</span><span class="p">)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="c1"># If no `type` given, use tune&#39;s UnifiedLogger as last resort.</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>            <span class="k">def</span> <span class="nf">default_logger_creator</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>                <span class="sd">&quot;&quot;&quot;Creates a Unified logger with the default prefix.&quot;&quot;&quot;</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>                <span class="k">return</span> <span class="n">UnifiedLogger</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">logdir</span><span class="p">,</span> <span class="n">loggers</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="n">logger_creator</span> <span class="o">=</span> <span class="n">default_logger_creator</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">logger_creator</span><span class="p">,</span> <span class="n">remote_checkpoint_dir</span><span class="p">,</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>                     <span class="n">sync_function_tpl</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.add_policy">
<code class="highlight language-python"><span class="n">add_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">policy_id</span><span class="p">,</span> <span class="n">policy_cls</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">observation_space</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action_space</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">policy_mapping_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">policies_to_train</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">evaluation_workers</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Adds a new policy to this Trainer.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>policy_id</code></td>
        <td><code>PolicyID</code></td>
        <td><p>ID of the policy to add.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>policy_cls</code></td>
        <td><code>Type[Policy]</code></td>
        <td><p>The Policy class to use for
constructing the new Policy.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>observation_space</code></td>
        <td><code>Optional[gym.spaces.Space]</code></td>
        <td><p>The observation
space of the policy to add.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>action_space</code></td>
        <td><code>Optional[gym.spaces.Space]</code></td>
        <td><p>The action space
of the policy to add.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>config</code></td>
        <td><code>Optional[PartialTrainerConfigDict]</code></td>
        <td><p>The config overrides
for the policy to add.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>policy_mapping_fn</code></td>
        <td><code>Optional[Callable[[AgentID], PolicyID]]</code></td>
        <td><p>An
optional (updated) policy mapping function to use from here on.
Note that already ongoing episodes will not change their
mapping but will use the old mapping till the end of the
episode.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>policies_to_train</code></td>
        <td><code>Optional[List[PolicyID]]</code></td>
        <td><p>An optional list of
policy IDs to be trained. If None, will keep the existing list
in place. Policies, whose IDs are not in the list will not be
updated.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>evaluation_workers</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to add the new policy also
to the evaluation WorkerSet.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Policy</code></td>
      <td><p>The newly added policy (the copy that got added to the
    local worker).</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@PublicAPI</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">def</span> <span class="nf">add_policy</span><span class="p">(</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>        <span class="n">policy_id</span><span class="p">:</span> <span class="n">PolicyID</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>        <span class="n">policy_cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Policy</span><span class="p">],</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>        <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>        <span class="n">observation_space</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">gym</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Space</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>        <span class="n">action_space</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">gym</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Space</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>        <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PartialTrainerConfigDict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>        <span class="n">policy_mapping_fn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">AgentID</span><span class="p">,</span> <span class="n">EpisodeID</span><span class="p">],</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>                                             <span class="n">PolicyID</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>        <span class="n">policies_to_train</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PolicyID</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>        <span class="n">evaluation_workers</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Policy</span><span class="p">:</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>    <span class="sd">&quot;&quot;&quot;Adds a new policy to this Trainer.</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">        policy_id (PolicyID): ID of the policy to add.</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">        policy_cls (Type[Policy]): The Policy class to use for</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">            constructing the new Policy.</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">        observation_space (Optional[gym.spaces.Space]): The observation</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">            space of the policy to add.</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">        action_space (Optional[gym.spaces.Space]): The action space</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">            of the policy to add.</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">        config (Optional[PartialTrainerConfigDict]): The config overrides</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">            for the policy to add.</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        policy_mapping_fn (Optional[Callable[[AgentID], PolicyID]]): An</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">            optional (updated) policy mapping function to use from here on.</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">            Note that already ongoing episodes will not change their</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">            mapping but will use the old mapping till the end of the</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">            episode.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        policies_to_train (Optional[List[PolicyID]]): An optional list of</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">            policy IDs to be trained. If None, will keep the existing list</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">            in place. Policies, whose IDs are not in the list will not be</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">            updated.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        evaluation_workers (bool): Whether to add the new policy also</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">            to the evaluation WorkerSet.</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        Policy: The newly added policy (the copy that got added to the</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">            local worker).</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="k">def</span> <span class="nf">fn</span><span class="p">(</span><span class="n">worker</span><span class="p">:</span> <span class="n">RolloutWorker</span><span class="p">):</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="c1"># `foreach_worker` function: Adds the policy the the worker (and</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="c1"># maybe changes its policy_mapping_fn - if provided here).</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="n">worker</span><span class="o">.</span><span class="n">add_policy</span><span class="p">(</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>            <span class="n">policy_id</span><span class="o">=</span><span class="n">policy_id</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>            <span class="n">policy_cls</span><span class="o">=</span><span class="n">policy_cls</span><span class="p">,</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>            <span class="n">observation_space</span><span class="o">=</span><span class="n">observation_space</span><span class="p">,</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>            <span class="n">action_space</span><span class="o">=</span><span class="n">action_space</span><span class="p">,</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>            <span class="n">policy_mapping_fn</span><span class="o">=</span><span class="n">policy_mapping_fn</span><span class="p">,</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>            <span class="n">policies_to_train</span><span class="o">=</span><span class="n">policies_to_train</span><span class="p">,</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="p">)</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="c1"># Run foreach_worker fn on all workers (incl. evaluation workers).</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">workers</span><span class="o">.</span><span class="n">foreach_worker</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="k">if</span> <span class="n">evaluation_workers</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_workers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_workers</span><span class="o">.</span><span class="n">foreach_worker</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="c1"># Return newly added policy (from the local rollout worker).</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_policy</span><span class="p">(</span><span class="n">policy_id</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.cleanup">
<code class="highlight language-python"><span class="n">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Subclasses should override this for any cleanup on stop.</p>
<p>If any Ray actors are launched in the Trainable (i.e., with a RLlib
trainer), be sure to kill the Ray actor process here.</p>
<p>You can kill a Ray actor by calling <code>actor.__ray_terminate__.remote()</code>
on the actor.</p>
<p>.. versionadded:: 0.8.7</p>

        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@override</span><span class="p">(</span><span class="n">Trainable</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span class="c1"># Stop all workers.</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;workers&quot;</span><span class="p">):</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">workers</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>    <span class="c1"># Stop all optimizers.</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;optimizer&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="p">:</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.collect_metrics">
<code class="highlight language-python"><span class="n">collect_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selected_workers</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Collects metrics from the remote workers of this agent.</p>
<p>This is the same data as returned by a call to train().</p>

        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@DeveloperAPI</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">def</span> <span class="nf">collect_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>                    <span class="n">selected_workers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActorHandle</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>    <span class="sd">&quot;&quot;&quot;Collects metrics from the remote workers of this agent.</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="sd">    This is the same data as returned by a call to train().</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">collect_metrics</span><span class="p">(</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;collect_metrics_timeout&quot;</span><span class="p">],</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>        <span class="n">min_history</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;metrics_smoothing_episodes&quot;</span><span class="p">],</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>        <span class="n">selected_workers</span><span class="o">=</span><span class="n">selected_workers</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.compute_actions">
<code class="highlight language-python"><span class="n">compute_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observations</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">prev_action</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prev_reward</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">policy_id</span><span class="o">=</span><span class="s1">&#39;default_policy&#39;</span><span class="p">,</span> <span class="n">full_fetch</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">explore</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">episodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unsquash_actions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clip_actions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normalize_actions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Computes an action for the specified policy on the local Worker.</p>
<p>Note that you can also access the policy object through
self.get_policy(policy_id) and call compute_actions() on it directly.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>observation</code></td>
        <td></td>
        <td><p>Observation from the environment.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>state</code></td>
        <td><code>Optional[List[Union[Any, dict, tuple]]]</code></td>
        <td><p>RNN hidden state, if any. If state is not None,
then all of compute_single_action(...) is returned
(computed action, rnn state(s), logits dictionary).
Otherwise compute_single_action(...)[0] is returned
(computed action).</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>prev_action</code></td>
        <td><code>Union[Any, dict, tuple]</code></td>
        <td><p>Previous action value, if any.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>prev_reward</code></td>
        <td><code>Union[Any, dict, tuple]</code></td>
        <td><p>Previous reward, if any.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>info</code></td>
        <td><code>Optional[dict]</code></td>
        <td><p>Env info dict, if any.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>policy_id</code></td>
        <td><code>str</code></td>
        <td><p>Policy to query (only applies to multi-agent).</p></td>
        <td><code>&#39;default_policy&#39;</code></td>
      </tr>
      <tr>
        <td><code>full_fetch</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to return extra action fetch results.
This is always set to True if RNN state is specified.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>explore</code></td>
        <td><code>Optional[bool]</code></td>
        <td><p>Whether to pick an exploitation or exploration
action (default: None -&gt; use self.config["explore"]).</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>timestep</code></td>
        <td><code>Optional[int]</code></td>
        <td><p>The current (sampling) time step.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>episodes</code></td>
        <td><code>Optional[List[ray.rllib.evaluation.episode.Episode]]</code></td>
        <td><p>This provides access to all of the internal episodes'
state, which may be useful for model-based or multi-agent
algorithms.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>unsquash_actions</code></td>
        <td><code>Optional[bool]</code></td>
        <td><p>Should actions be unsquashed according
to the env's/Policy's action space? If None, use
self.config["normalize_actions"].</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>clip_actions</code></td>
        <td><code>Optional[bool]</code></td>
        <td><p>Should actions be clipped according to the
env's/Policy's action space? If None, use
self.config["clip_actions"].</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>any</code></td>
      <td><p>The computed action if full_fetch=False, or
tuple: The full output of policy.compute_actions() if
full_fetch=True or we have an RNN-based Policy.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@PublicAPI</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">def</span> <span class="nf">compute_actions</span><span class="p">(</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>        <span class="n">observations</span><span class="p">:</span> <span class="n">TensorStructType</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>        <span class="n">state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">TensorStructType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>        <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>        <span class="n">prev_action</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TensorStructType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>        <span class="n">prev_reward</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TensorStructType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>        <span class="n">info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvInfoDict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>        <span class="n">policy_id</span><span class="p">:</span> <span class="n">PolicyID</span> <span class="o">=</span> <span class="n">DEFAULT_POLICY_ID</span><span class="p">,</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>        <span class="n">full_fetch</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>        <span class="n">explore</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>        <span class="n">timestep</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>        <span class="n">episodes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Episode</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>        <span class="n">unsquash_actions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>        <span class="n">clip_actions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>        <span class="c1"># Deprecated.</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>        <span class="n">normalize_actions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="p">):</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="sd">&quot;&quot;&quot;Computes an action for the specified policy on the local Worker.</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    Note that you can also access the policy object through</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    self.get_policy(policy_id) and call compute_actions() on it directly.</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        observation: Observation from the environment.</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">        state: RNN hidden state, if any. If state is not None,</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">            then all of compute_single_action(...) is returned</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">            (computed action, rnn state(s), logits dictionary).</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">            Otherwise compute_single_action(...)[0] is returned</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">            (computed action).</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        prev_action: Previous action value, if any.</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        prev_reward: Previous reward, if any.</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        info: Env info dict, if any.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        policy_id: Policy to query (only applies to multi-agent).</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        full_fetch: Whether to return extra action fetch results.</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">            This is always set to True if RNN state is specified.</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        explore: Whether to pick an exploitation or exploration</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">            action (default: None -&gt; use self.config[&quot;explore&quot;]).</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">        timestep: The current (sampling) time step.</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        episodes: This provides access to all of the internal episodes&#39;</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">            state, which may be useful for model-based or multi-agent</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">            algorithms.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        unsquash_actions: Should actions be unsquashed according</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">            to the env&#39;s/Policy&#39;s action space? If None, use</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">            self.config[&quot;normalize_actions&quot;].</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        clip_actions: Should actions be clipped according to the</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">            env&#39;s/Policy&#39;s action space? If None, use</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">            self.config[&quot;clip_actions&quot;].</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    Keyword Args:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        kwargs: forward compatibility placeholder</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        any: The computed action if full_fetch=False, or</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        tuple: The full output of policy.compute_actions() if</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        full_fetch=True or we have an RNN-based Policy.</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="k">if</span> <span class="n">normalize_actions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="n">deprecation_warning</span><span class="p">(</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>            <span class="n">old</span><span class="o">=</span><span class="s2">&quot;Trainer.compute_actions(`normalize_actions`=...)&quot;</span><span class="p">,</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="n">new</span><span class="o">=</span><span class="s2">&quot;Trainer.compute_actions(`unsquash_actions`=...)&quot;</span><span class="p">,</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>            <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="n">unsquash_actions</span> <span class="o">=</span> <span class="n">normalize_actions</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="c1"># Preprocess obs and states.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="n">state_defined</span> <span class="o">=</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="n">policy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_policy</span><span class="p">(</span><span class="n">policy_id</span><span class="p">)</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="n">filtered_obs</span><span class="p">,</span> <span class="n">filtered_state</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="k">for</span> <span class="n">agent_id</span><span class="p">,</span> <span class="n">ob</span> <span class="ow">in</span> <span class="n">observations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="n">worker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workers</span><span class="o">.</span><span class="n">local_worker</span><span class="p">()</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="n">preprocessed</span> <span class="o">=</span> <span class="n">worker</span><span class="o">.</span><span class="n">preprocessors</span><span class="p">[</span><span class="n">policy_id</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">ob</span><span class="p">)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="n">filtered</span> <span class="o">=</span> <span class="n">worker</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="n">policy_id</span><span class="p">](</span><span class="n">preprocessed</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="n">filtered_obs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filtered</span><span class="p">)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>            <span class="k">continue</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="k">elif</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>            <span class="n">filtered_state</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="n">agent_id</span><span class="p">])</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="n">filtered_state</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">policy</span><span class="o">.</span><span class="n">get_initial_state</span><span class="p">())</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="c1"># Batch obs and states</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="n">obs_batch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">filtered_obs</span><span class="p">)</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="n">state</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="n">state</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">filtered_state</span><span class="p">))</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="n">state</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">state</span><span class="p">]</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="n">input_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">SampleBatch</span><span class="o">.</span><span class="n">OBS</span><span class="p">:</span> <span class="n">obs_batch</span><span class="p">}</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="k">if</span> <span class="n">prev_action</span><span class="p">:</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="n">input_dict</span><span class="p">[</span><span class="n">SampleBatch</span><span class="o">.</span><span class="n">PREV_ACTIONS</span><span class="p">]</span> <span class="o">=</span> <span class="n">prev_action</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="k">if</span> <span class="n">prev_reward</span><span class="p">:</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="n">input_dict</span><span class="p">[</span><span class="n">SampleBatch</span><span class="o">.</span><span class="n">PREV_REWARDS</span><span class="p">]</span> <span class="o">=</span> <span class="n">prev_reward</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="k">if</span> <span class="n">info</span><span class="p">:</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="n">input_dict</span><span class="p">[</span><span class="n">SampleBatch</span><span class="o">.</span><span class="n">INFOS</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="n">input_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;state_in_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="c1"># Batch compute actions</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="n">actions</span><span class="p">,</span> <span class="n">states</span><span class="p">,</span> <span class="n">infos</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">compute_actions_from_input_dict</span><span class="p">(</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="n">input_dict</span><span class="o">=</span><span class="n">input_dict</span><span class="p">,</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="n">explore</span><span class="o">=</span><span class="n">explore</span><span class="p">,</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="n">episodes</span><span class="o">=</span><span class="n">episodes</span><span class="p">,</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="p">)</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="c1"># Unbatch actions for the environment into a multi-agent dict.</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="n">single_actions</span> <span class="o">=</span> <span class="n">space_utils</span><span class="o">.</span><span class="n">unbatch</span><span class="p">(</span><span class="n">actions</span><span class="p">)</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="n">actions</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">observations</span><span class="p">,</span> <span class="n">single_actions</span><span class="p">):</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="c1"># If we work in normalized action space (normalize_actions=True),</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="c1"># we re-translate here into the env&#39;s action space.</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="k">if</span> <span class="n">unsquash_actions</span><span class="p">:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>            <span class="n">a</span> <span class="o">=</span> <span class="n">space_utils</span><span class="o">.</span><span class="n">unsquash_action</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">policy</span><span class="o">.</span><span class="n">action_space_struct</span><span class="p">)</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="c1"># Clip, according to env&#39;s action space.</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="k">elif</span> <span class="n">clip_actions</span><span class="p">:</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="n">a</span> <span class="o">=</span> <span class="n">space_utils</span><span class="o">.</span><span class="n">clip_action</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">policy</span><span class="o">.</span><span class="n">action_space_struct</span><span class="p">)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="n">actions</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="c1"># Unbatch states into a multi-agent dict.</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="n">unbatched_states</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">observations</span><span class="p">):</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="n">unbatched_states</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">states</span><span class="p">]</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="c1"># Return only actions or full tuple</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="k">if</span> <span class="n">state_defined</span> <span class="ow">or</span> <span class="n">full_fetch</span><span class="p">:</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="k">return</span> <span class="n">actions</span><span class="p">,</span> <span class="n">unbatched_states</span><span class="p">,</span> <span class="n">infos</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="k">return</span> <span class="n">actions</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.compute_single_action">
<code class="highlight language-python"><span class="n">compute_single_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">prev_action</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prev_reward</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">input_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">policy_id</span><span class="o">=</span><span class="s1">&#39;default_policy&#39;</span><span class="p">,</span> <span class="n">full_fetch</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">explore</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">episode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unsquash_action</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clip_action</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unsquash_actions</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">clip_actions</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Computes an action for the specified policy on the local worker.</p>
<p>Note that you can also access the policy object through
self.get_policy(policy_id) and call compute_single_action() on it
directly.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>observation</code></td>
        <td><code>Union[Any, dict, tuple]</code></td>
        <td><p>Single (unbatched) observation from the
environment.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>state</code></td>
        <td><code>Optional[List[Union[Any, dict, tuple]]]</code></td>
        <td><p>List of all RNN hidden (single, unbatched) state tensors.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>prev_action</code></td>
        <td><code>Union[Any, dict, tuple]</code></td>
        <td><p>Single (unbatched) previous action value.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>prev_reward</code></td>
        <td><code>Optional[float]</code></td>
        <td><p>Single (unbatched) previous reward value.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>info</code></td>
        <td><code>Optional[dict]</code></td>
        <td><p>Env info dict, if any.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>input_dict</code></td>
        <td><code>Optional[ray.rllib.policy.sample_batch.SampleBatch]</code></td>
        <td><p>An optional SampleBatch that holds all the values
for: obs, state, prev_action, and prev_reward, plus maybe
custom defined views of the current env trajectory. Note
that only one of <code>obs</code> or <code>input_dict</code> must be non-None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>policy_id</code></td>
        <td><code>str</code></td>
        <td><p>Policy to query (only applies to multi-agent).
Default: "default_policy".</p></td>
        <td><code>&#39;default_policy&#39;</code></td>
      </tr>
      <tr>
        <td><code>full_fetch</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to return extra action fetch results.
This is always set to True if <code>state</code> is specified.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>explore</code></td>
        <td><code>Optional[bool]</code></td>
        <td><p>Whether to apply exploration to the action.
Default: None -&gt; use self.config["explore"].</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>timestep</code></td>
        <td><code>Optional[int]</code></td>
        <td><p>The current (sampling) time step.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>episode</code></td>
        <td><code>Optional[ray.rllib.evaluation.episode.Episode]</code></td>
        <td><p>This provides access to all of the internal episodes'
state, which may be useful for model-based or multi-agent
algorithms.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>unsquash_action</code></td>
        <td><code>Optional[bool]</code></td>
        <td><p>Should actions be unsquashed according to the
env's/Policy's action space? If None, use the value of
self.config["normalize_actions"].</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>clip_action</code></td>
        <td><code>Optional[bool]</code></td>
        <td><p>Should actions be clipped according to the
env's/Policy's action space? If None, use the value of
self.config["clip_actions"].</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Union[Any, dict, tuple, Tuple[Union[Any, dict, tuple], List[Any], Dict[str, Any]]]</code></td>
      <td><p>The computed action if full_fetch=False, or a tuple of a) the
    full output of policy.compute_actions() if full_fetch=True
    or we have an RNN-based Policy.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>KeyError</code></td>
        <td><p>If the <code>policy_id</code> cannot be found in this Trainer's
local worker.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@PublicAPI</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">def</span> <span class="nf">compute_single_action</span><span class="p">(</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>        <span class="n">observation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TensorStructType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>        <span class="n">state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">TensorStructType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>        <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>        <span class="n">prev_action</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TensorStructType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>        <span class="n">prev_reward</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>        <span class="n">info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvInfoDict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>        <span class="n">input_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SampleBatch</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>        <span class="n">policy_id</span><span class="p">:</span> <span class="n">PolicyID</span> <span class="o">=</span> <span class="n">DEFAULT_POLICY_ID</span><span class="p">,</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>        <span class="n">full_fetch</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>        <span class="n">explore</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>        <span class="n">timestep</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>        <span class="n">episode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Episode</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>        <span class="n">unsquash_action</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>        <span class="n">clip_action</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>        <span class="c1"># Deprecated args.</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>        <span class="n">unsquash_actions</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>        <span class="n">clip_actions</span><span class="o">=</span><span class="n">DEPRECATED_VALUE</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>        <span class="c1"># Kwargs placeholder for future compatibility.</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">TensorStructType</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TensorStructType</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">TensorType</span><span class="p">],</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>                                   <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TensorType</span><span class="p">]]]:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="sd">&quot;&quot;&quot;Computes an action for the specified policy on the local worker.</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    Note that you can also access the policy object through</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    self.get_policy(policy_id) and call compute_single_action() on it</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    directly.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        observation: Single (unbatched) observation from the</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">            environment.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        state: List of all RNN hidden (single, unbatched) state tensors.</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        prev_action: Single (unbatched) previous action value.</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        prev_reward: Single (unbatched) previous reward value.</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        info: Env info dict, if any.</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        input_dict: An optional SampleBatch that holds all the values</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">            for: obs, state, prev_action, and prev_reward, plus maybe</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">            custom defined views of the current env trajectory. Note</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">            that only one of `obs` or `input_dict` must be non-None.</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">        policy_id: Policy to query (only applies to multi-agent).</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">            Default: &quot;default_policy&quot;.</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        full_fetch: Whether to return extra action fetch results.</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">            This is always set to True if `state` is specified.</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        explore: Whether to apply exploration to the action.</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">            Default: None -&gt; use self.config[&quot;explore&quot;].</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        timestep: The current (sampling) time step.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        episode: This provides access to all of the internal episodes&#39;</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">            state, which may be useful for model-based or multi-agent</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">            algorithms.</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        unsquash_action: Should actions be unsquashed according to the</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">            env&#39;s/Policy&#39;s action space? If None, use the value of</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">            self.config[&quot;normalize_actions&quot;].</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        clip_action: Should actions be clipped according to the</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">            env&#39;s/Policy&#39;s action space? If None, use the value of</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">            self.config[&quot;clip_actions&quot;].</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    Keyword Args:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        kwargs: forward compatibility placeholder</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        The computed action if full_fetch=False, or a tuple of a) the</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">            full output of policy.compute_actions() if full_fetch=True</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">            or we have an RNN-based Policy.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        KeyError: If the `policy_id` cannot be found in this Trainer&#39;s</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">            local worker.</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="k">if</span> <span class="n">clip_actions</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="n">deprecation_warning</span><span class="p">(</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>            <span class="n">old</span><span class="o">=</span><span class="s2">&quot;Trainer.compute_single_action(`clip_actions`=...)&quot;</span><span class="p">,</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>            <span class="n">new</span><span class="o">=</span><span class="s2">&quot;Trainer.compute_single_action(`clip_action`=...)&quot;</span><span class="p">,</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>            <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="n">clip_action</span> <span class="o">=</span> <span class="n">clip_actions</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="k">if</span> <span class="n">unsquash_actions</span> <span class="o">!=</span> <span class="n">DEPRECATED_VALUE</span><span class="p">:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="n">deprecation_warning</span><span class="p">(</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="n">old</span><span class="o">=</span><span class="s2">&quot;Trainer.compute_single_action(`unsquash_actions`=...)&quot;</span><span class="p">,</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="n">new</span><span class="o">=</span><span class="s2">&quot;Trainer.compute_single_action(`unsquash_action`=...)&quot;</span><span class="p">,</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>            <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="n">unsquash_action</span> <span class="o">=</span> <span class="n">unsquash_actions</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="c1"># User provided an input-dict: Assert that `obs`, `prev_a|r`, `state`</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="c1"># are all None.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;Provide either `input_dict` OR [`observation`, ...] as &quot;</span> \
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>              <span class="s2">&quot;args to Trainer.compute_single_action!&quot;</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="k">if</span> <span class="n">input_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="k">assert</span> <span class="n">observation</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">prev_action</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> \
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>               <span class="n">prev_reward</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="n">err_msg</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="n">observation</span> <span class="o">=</span> <span class="n">input_dict</span><span class="p">[</span><span class="n">SampleBatch</span><span class="o">.</span><span class="n">OBS</span><span class="p">]</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="k">assert</span> <span class="n">observation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">err_msg</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="c1"># Get the policy to compute the action for (in the multi-agent case,</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="c1"># Trainer may hold &gt;1 policies).</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="n">policy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_policy</span><span class="p">(</span><span class="n">policy_id</span><span class="p">)</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="k">if</span> <span class="n">policy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="sa">f</span><span class="s2">&quot;PolicyID &#39;</span><span class="si">{</span><span class="n">policy_id</span><span class="si">}</span><span class="s2">&#39; not found in PolicyMap of the &quot;</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>            <span class="sa">f</span><span class="s2">&quot;Trainer&#39;s local worker!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="n">local_worker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workers</span><span class="o">.</span><span class="n">local_worker</span><span class="p">()</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="c1"># Check the preprocessor and preprocess, if necessary.</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="n">pp</span> <span class="o">=</span> <span class="n">local_worker</span><span class="o">.</span><span class="n">preprocessors</span><span class="p">[</span><span class="n">policy_id</span><span class="p">]</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="k">if</span> <span class="n">pp</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s2">&quot;NoPreprocessor&quot;</span><span class="p">:</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="n">observation</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">observation</span><span class="p">)</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="n">observation</span> <span class="o">=</span> <span class="n">local_worker</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="n">policy_id</span><span class="p">](</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="n">observation</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="c1"># Input-dict.</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="k">if</span> <span class="n">input_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="n">input_dict</span><span class="p">[</span><span class="n">SampleBatch</span><span class="o">.</span><span class="n">OBS</span><span class="p">]</span> <span class="o">=</span> <span class="n">observation</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="n">action</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">extra</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">compute_single_action</span><span class="p">(</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="n">input_dict</span><span class="o">=</span><span class="n">input_dict</span><span class="p">,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="n">explore</span><span class="o">=</span><span class="n">explore</span><span class="p">,</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="n">episode</span><span class="o">=</span><span class="n">episode</span><span class="p">,</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="c1"># Individual args.</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="n">action</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">extra</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">compute_single_action</span><span class="p">(</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="n">obs</span><span class="o">=</span><span class="n">observation</span><span class="p">,</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>            <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="n">prev_action</span><span class="o">=</span><span class="n">prev_action</span><span class="p">,</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="n">prev_reward</span><span class="o">=</span><span class="n">prev_reward</span><span class="p">,</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">,</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>            <span class="n">explore</span><span class="o">=</span><span class="n">explore</span><span class="p">,</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>            <span class="n">episode</span><span class="o">=</span><span class="n">episode</span><span class="p">,</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="p">)</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="c1"># If we work in normalized action space (normalize_actions=True),</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="c1"># we re-translate here into the env&#39;s action space.</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="k">if</span> <span class="n">unsquash_action</span><span class="p">:</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="n">action</span> <span class="o">=</span> <span class="n">space_utils</span><span class="o">.</span><span class="n">unsquash_action</span><span class="p">(</span><span class="n">action</span><span class="p">,</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>                                             <span class="n">policy</span><span class="o">.</span><span class="n">action_space_struct</span><span class="p">)</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="c1"># Clip, according to env&#39;s action space.</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="k">elif</span> <span class="n">clip_action</span><span class="p">:</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="n">action</span> <span class="o">=</span> <span class="n">space_utils</span><span class="o">.</span><span class="n">clip_action</span><span class="p">(</span><span class="n">action</span><span class="p">,</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                                         <span class="n">policy</span><span class="o">.</span><span class="n">action_space_struct</span><span class="p">)</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="c1"># Return 3-Tuple: Action, states, and extra-action fetches.</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="k">if</span> <span class="n">state</span> <span class="ow">or</span> <span class="n">full_fetch</span><span class="p">:</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="k">return</span> <span class="n">action</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">extra</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="c1"># Ensure backward compatibility.</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="k">return</span> <span class="n">action</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.default_resource_request">
<code class="highlight language-python"><span class="n">default_resource_request</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>Provides a static resource requirement for the given configuration.</p>
<p>This can be overridden by sub-classes to set the correct trial resource
allocation, so the user does not need to.</p>
<p>.. code-block:: python</p>
<div class="highlight"><pre><span></span><code>@classmethod
def default_resource_request(cls, config):
    return PlacementGroupFactory([{&quot;CPU&quot;: 1}, {&quot;CPU&quot;: 1}]])
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>config[Dict[str,</code></td>
        <td><code>Any]]</code></td>
        <td><p>The Trainable's config dict.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Union[Resources, PlacementGroupFactory]</code></td>
      <td><p>A Resources object or
    PlacementGroupFactory consumed by Tune for queueing.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="nd">@override</span><span class="p">(</span><span class="n">Trainable</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="k">def</span> <span class="nf">default_resource_request</span><span class="p">(</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>        <span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">PartialTrainerConfigDict</span><span class="p">)</span> <span class="o">-&gt;</span> \
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>        <span class="n">Union</span><span class="p">[</span><span class="n">Resources</span><span class="p">,</span> <span class="n">PlacementGroupFactory</span><span class="p">]:</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>    <span class="c1"># Default logic for RLlib algorithms (Trainers):</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>    <span class="c1"># Create one bundle per individual worker (local or remote).</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>    <span class="c1"># Use `num_cpus_for_driver` and `num_gpus` for the local worker and</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>    <span class="c1"># `num_cpus_per_worker` and `num_gpus_per_worker` for the remote</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>    <span class="c1"># workers to determine their CPU/GPU resource needs.</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>    <span class="c1"># Convenience config handles.</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>    <span class="n">cf</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_default_config</span><span class="p">(),</span> <span class="o">**</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>    <span class="n">eval_cf</span> <span class="o">=</span> <span class="n">cf</span><span class="p">[</span><span class="s2">&quot;evaluation_config&quot;</span><span class="p">]</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="c1"># TODO(ekl): add custom resources here once tune supports them</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="c1"># Return PlacementGroupFactory containing all needed resources</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="c1"># (already properly defined as device bundles).</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="k">return</span> <span class="n">PlacementGroupFactory</span><span class="p">(</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>        <span class="n">bundles</span><span class="o">=</span><span class="p">[{</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>            <span class="c1"># Local worker.</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>            <span class="s2">&quot;CPU&quot;</span><span class="p">:</span> <span class="n">cf</span><span class="p">[</span><span class="s2">&quot;num_cpus_for_driver&quot;</span><span class="p">],</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>            <span class="s2">&quot;GPU&quot;</span><span class="p">:</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">cf</span><span class="p">[</span><span class="s2">&quot;_fake_gpus&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="n">cf</span><span class="p">[</span><span class="s2">&quot;num_gpus&quot;</span><span class="p">],</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>        <span class="p">}]</span> <span class="o">+</span> <span class="p">[</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>            <span class="p">{</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>                <span class="c1"># RolloutWorkers.</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>                <span class="s2">&quot;CPU&quot;</span><span class="p">:</span> <span class="n">cf</span><span class="p">[</span><span class="s2">&quot;num_cpus_per_worker&quot;</span><span class="p">],</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>                <span class="s2">&quot;GPU&quot;</span><span class="p">:</span> <span class="n">cf</span><span class="p">[</span><span class="s2">&quot;num_gpus_per_worker&quot;</span><span class="p">],</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>            <span class="p">}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cf</span><span class="p">[</span><span class="s2">&quot;num_workers&quot;</span><span class="p">])</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>        <span class="p">]</span> <span class="o">+</span> <span class="p">([</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>            <span class="p">{</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>                <span class="c1"># Evaluation workers.</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>                <span class="c1"># Note: The local eval worker is located on the driver CPU.</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>                <span class="s2">&quot;CPU&quot;</span><span class="p">:</span> <span class="n">eval_cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;num_cpus_per_worker&quot;</span><span class="p">,</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>                                   <span class="n">cf</span><span class="p">[</span><span class="s2">&quot;num_cpus_per_worker&quot;</span><span class="p">]),</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>                <span class="s2">&quot;GPU&quot;</span><span class="p">:</span> <span class="n">eval_cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;num_gpus_per_worker&quot;</span><span class="p">,</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>                                   <span class="n">cf</span><span class="p">[</span><span class="s2">&quot;num_gpus_per_worker&quot;</span><span class="p">]),</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>            <span class="p">}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cf</span><span class="p">[</span><span class="s2">&quot;evaluation_num_workers&quot;</span><span class="p">])</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="p">]</span> <span class="k">if</span> <span class="n">cf</span><span class="p">[</span><span class="s2">&quot;evaluation_interval&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="p">[]),</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="n">strategy</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;placement_strategy&quot;</span><span class="p">,</span> <span class="s2">&quot;PACK&quot;</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.evaluate">
<code class="highlight language-python"><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episodes_left_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Evaluates current policy under <code>evaluation_config</code> settings.</p>
<p>Note that this default implementation does not do anything beyond
merging evaluation_config with the normal trainer config.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>episodes_left_fn</code></td>
        <td><code>Optional[Callable[[int], int]]</code></td>
        <td><p>An optional callable taking the already run
num episodes as only arg and returning the number of
episodes left to run. It's used to find out whether
evaluation should continue.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@PublicAPI</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episodes_left_fn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>             <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>    <span class="sd">&quot;&quot;&quot;Evaluates current policy under `evaluation_config` settings.</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="sd">    Note that this default implementation does not do anything beyond</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="sd">    merging evaluation_config with the normal trainer config.</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">        episodes_left_fn: An optional callable taking the already run</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">            num episodes as only arg and returning the number of</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">            episodes left to run. It&#39;s used to find out whether</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">            evaluation should continue.</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>    <span class="c1"># In case we are evaluating (in a thread) parallel to training,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>    <span class="c1"># we may have to re-enable eager mode here (gets disabled in the</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="c1"># thread).</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;framework&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;tf2&quot;</span><span class="p">,</span> <span class="s2">&quot;tfe&quot;</span><span class="p">]</span> <span class="ow">and</span> \
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>            <span class="ow">not</span> <span class="n">tf</span><span class="o">.</span><span class="n">executing_eagerly</span><span class="p">():</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>        <span class="n">tf1</span><span class="o">.</span><span class="n">enable_eager_execution</span><span class="p">()</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="c1"># Call the `_before_evaluate` hook.</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_before_evaluate</span><span class="p">()</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="c1"># Sync weights to the evaluation WorkerSet.</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_workers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sync_weights_to_workers</span><span class="p">(</span><span class="n">worker_set</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluation_workers</span><span class="p">)</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sync_filters_if_needed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluation_workers</span><span class="p">)</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;custom_eval_function&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running custom eval function </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;custom_eval_function&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>        <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;custom_eval_function&quot;</span><span class="p">](</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>            <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_workers</span><span class="p">)</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">metrics</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Custom eval function must return &quot;</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>                             <span class="s2">&quot;dict of metrics, got </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">metrics</span><span class="p">))</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="c1"># How many episodes do we need to run?</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="c1"># In &quot;auto&quot; mode (only for parallel eval + training): Run one</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="c1"># episode per eval worker.</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="n">num_episodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;evaluation_num_episodes&quot;</span><span class="p">]</span> <span class="k">if</span> \
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;evaluation_num_episodes&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;auto&quot;</span> <span class="k">else</span> \
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;evaluation_num_workers&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="c1"># Default done-function returns True, whenever num episodes</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="c1"># have been completed.</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="k">if</span> <span class="n">episodes_left_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>            <span class="k">def</span> <span class="nf">episodes_left_fn</span><span class="p">(</span><span class="n">num_episodes_done</span><span class="p">):</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>                <span class="k">return</span> <span class="n">num_episodes</span> <span class="o">-</span> <span class="n">num_episodes_done</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>            <span class="sa">f</span><span class="s2">&quot;Evaluating current policy for </span><span class="si">{</span><span class="n">num_episodes</span><span class="si">}</span><span class="s2"> episodes.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>        <span class="n">metrics</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="c1"># No evaluation worker set -&gt;</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="c1"># Do evaluation using the local worker. Expect error due to the</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="c1"># local worker not having an env.</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_workers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_episodes</span><span class="p">):</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">workers</span><span class="o">.</span><span class="n">local_worker</span><span class="p">()</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>                <span class="n">metrics</span> <span class="o">=</span> <span class="n">collect_metrics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workers</span><span class="o">.</span><span class="n">local_worker</span><span class="p">())</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>                <span class="k">if</span> <span class="s2">&quot;RolloutWorker has no `input_reader` object&quot;</span> <span class="ow">in</span> \
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>                        <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>                        <span class="s2">&quot;Cannot evaluate w/o an evaluation worker set in &quot;</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>                        <span class="s2">&quot;the Trainer or w/o an env on the local worker!</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>                        <span class="s2">&quot;Try one of the following:</span><span class="se">\n</span><span class="s2">1) Set &quot;</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>                        <span class="s2">&quot;`evaluation_interval` &gt;= 0 to force creating a &quot;</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>                        <span class="s2">&quot;separate evaluation worker set.</span><span class="se">\n</span><span class="s2">2) Set &quot;</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>                        <span class="s2">&quot;`create_env_on_driver=True` to force the local &quot;</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>                        <span class="s2">&quot;(non-eval) worker to have an environment to &quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>                        <span class="s2">&quot;evaluate on.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>                    <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="c1"># Evaluation worker set only has local worker.</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;evaluation_num_workers&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_episodes</span><span class="p">):</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_workers</span><span class="o">.</span><span class="n">local_worker</span><span class="p">()</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="c1"># Evaluation worker set has n remote workers.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>            <span class="c1"># How many episodes have we run (across all eval workers)?</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="n">num_episodes_done</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="n">round_</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>                <span class="n">episodes_left_to_do</span> <span class="o">=</span> <span class="n">episodes_left_fn</span><span class="p">(</span><span class="n">num_episodes_done</span><span class="p">)</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>                <span class="k">if</span> <span class="n">episodes_left_to_do</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>                    <span class="k">break</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>                <span class="n">round_</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>                <span class="n">batches</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">([</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>                    <span class="n">w</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_workers</span><span class="o">.</span><span class="n">remote_workers</span><span class="p">())</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>                    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">episodes_left_to_do</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>                <span class="p">])</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>                <span class="c1"># Per our config for the evaluation workers</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>                <span class="c1"># (`rollout_fragment_length=1` and</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>                <span class="c1"># `batch_mode=complete_episode`), we know that we&#39;ll have</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>                <span class="c1"># exactly one episode per returned batch.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>                <span class="n">num_episodes_done</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">batches</span><span class="p">)</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>                    <span class="sa">f</span><span class="s2">&quot;Ran round </span><span class="si">{</span><span class="n">round_</span><span class="si">}</span><span class="s2"> of parallel evaluation &quot;</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>                    <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">num_episodes_done</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">num_episodes</span><span class="si">}</span><span class="s2"> episodes done)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="k">if</span> <span class="n">metrics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="n">metrics</span> <span class="o">=</span> <span class="n">collect_metrics</span><span class="p">(</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_workers</span><span class="o">.</span><span class="n">local_worker</span><span class="p">(),</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_workers</span><span class="o">.</span><span class="n">remote_workers</span><span class="p">())</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;evaluation&quot;</span><span class="p">:</span> <span class="n">metrics</span><span class="p">}</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.export_policy_checkpoint">
<code class="highlight language-python"><span class="n">export_policy_checkpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">export_dir</span><span class="p">,</span> <span class="n">filename_prefix</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">policy_id</span><span class="o">=</span><span class="s1">&#39;default_policy&#39;</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Exports policy model checkpoint to a local directory.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>export_dir</code></td>
        <td><code>str</code></td>
        <td><p>Writable local directory.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>filename_prefix</code></td>
        <td><code>str</code></td>
        <td><p>file name prefix of checkpoint files.</p></td>
        <td><code>&#39;model&#39;</code></td>
      </tr>
      <tr>
        <td><code>policy_id</code></td>
        <td><code>str</code></td>
        <td><p>Optional policy id to export.</p></td>
        <td><code>&#39;default_policy&#39;</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">trainer</span> <span class="o">=</span> <span class="n">MyTrainer</span><span class="p">()</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="o">&gt;&gt;&gt;</span>     <span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">trainer</span><span class="o">.</span><span class="n">export_policy_checkpoint</span><span class="p">(</span><span class="s2">&quot;/tmp/export_dir&quot;</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@DeveloperAPI</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">def</span> <span class="nf">export_policy_checkpoint</span><span class="p">(</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>        <span class="n">export_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>        <span class="n">filename_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>        <span class="n">policy_id</span><span class="p">:</span> <span class="n">PolicyID</span> <span class="o">=</span> <span class="n">DEFAULT_POLICY_ID</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>    <span class="sd">&quot;&quot;&quot;Exports policy model checkpoint to a local directory.</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">        export_dir: Writable local directory.</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">        filename_prefix: file name prefix of checkpoint files.</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">        policy_id: Optional policy id to export.</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">        &gt;&gt;&gt; trainer = MyTrainer()</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">        &gt;&gt;&gt; for _ in range(10):</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">        &gt;&gt;&gt;     trainer.train()</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">        &gt;&gt;&gt; trainer.export_policy_checkpoint(&quot;/tmp/export_dir&quot;)</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">get_policy</span><span class="p">(</span><span class="n">policy_id</span><span class="p">)</span><span class="o">.</span><span class="n">export_checkpoint</span><span class="p">(</span><span class="n">export_dir</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>                                                 <span class="n">filename_prefix</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.export_policy_model">
<code class="highlight language-python"><span class="n">export_policy_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">export_dir</span><span class="p">,</span> <span class="n">policy_id</span><span class="o">=</span><span class="s1">&#39;default_policy&#39;</span><span class="p">,</span> <span class="n">onnx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Exports policy model with given policy_id to a local directory.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>export_dir</code></td>
        <td><code>str</code></td>
        <td><p>Writable local directory.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>policy_id</code></td>
        <td><code>str</code></td>
        <td><p>Optional policy id to export.</p></td>
        <td><code>&#39;default_policy&#39;</code></td>
      </tr>
      <tr>
        <td><code>onnx</code></td>
        <td><code>Optional[int]</code></td>
        <td><p>If given, will export model in ONNX format. The
value of this parameter set the ONNX OpSet version to use.
If None, the output format will be DL framework specific.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">trainer</span> <span class="o">=</span> <span class="n">MyTrainer</span><span class="p">()</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="o">&gt;&gt;&gt;</span>     <span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">trainer</span><span class="o">.</span><span class="n">export_policy_model</span><span class="p">(</span><span class="s2">&quot;/tmp/dir&quot;</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">trainer</span><span class="o">.</span><span class="n">export_policy_model</span><span class="p">(</span><span class="s2">&quot;/tmp/dir/onnx&quot;</span><span class="p">,</span> <span class="n">onnx</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@DeveloperAPI</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">def</span> <span class="nf">export_policy_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>                        <span class="n">export_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>                        <span class="n">policy_id</span><span class="p">:</span> <span class="n">PolicyID</span> <span class="o">=</span> <span class="n">DEFAULT_POLICY_ID</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>                        <span class="n">onnx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>    <span class="sd">&quot;&quot;&quot;Exports policy model with given policy_id to a local directory.</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">        export_dir: Writable local directory.</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">        policy_id: Optional policy id to export.</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">        onnx: If given, will export model in ONNX format. The</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">            value of this parameter set the ONNX OpSet version to use.</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">            If None, the output format will be DL framework specific.</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">        &gt;&gt;&gt; trainer = MyTrainer()</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">        &gt;&gt;&gt; for _ in range(10):</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">        &gt;&gt;&gt;     trainer.train()</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">        &gt;&gt;&gt; trainer.export_policy_model(&quot;/tmp/dir&quot;)</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">        &gt;&gt;&gt; trainer.export_policy_model(&quot;/tmp/dir/onnx&quot;, onnx=1)</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">get_policy</span><span class="p">(</span><span class="n">policy_id</span><span class="p">)</span><span class="o">.</span><span class="n">export_model</span><span class="p">(</span><span class="n">export_dir</span><span class="p">,</span> <span class="n">onnx</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.get_default_policy_class">
<code class="highlight language-python"><span class="n">get_default_policy_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Returns a default Policy class to use, given a config.</p>
<p>This class will be used inside RolloutWorkers' PolicyMaps in case
the policy class is not provided by the user in any single- or
multi-agent PolicySpec.</p>
<p>This method is experimental and currently only used, iff the Trainer
class was not created using the <code>build_trainer</code> utility and if
the Trainer sub-class does not override <code>_init()</code> and create it's
own WorkerSet in <code>_init()</code>.</p>

        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@ExperimentalAPI</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">def</span> <span class="nf">get_default_policy_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">PartialTrainerConfigDict</span><span class="p">):</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span class="sd">&quot;&quot;&quot;Returns a default Policy class to use, given a config.</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="sd">    This class will be used inside RolloutWorkers&#39; PolicyMaps in case</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="sd">    the policy class is not provided by the user in any single- or</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="sd">    multi-agent PolicySpec.</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">    This method is experimental and currently only used, iff the Trainer</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">    class was not created using the `build_trainer` utility and if</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">    the Trainer sub-class does not override `_init()` and create it&#39;s</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">    own WorkerSet in `_init()`.</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_policy_class&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.get_policy">
<code class="highlight language-python"><span class="n">get_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">policy_id</span><span class="o">=</span><span class="s1">&#39;default_policy&#39;</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Return policy for the specified id, or None.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>policy_id</code></td>
        <td><code>str</code></td>
        <td><p>ID of the policy to return.</p></td>
        <td><code>&#39;default_policy&#39;</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@PublicAPI</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">def</span> <span class="nf">get_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">policy_id</span><span class="p">:</span> <span class="n">PolicyID</span> <span class="o">=</span> <span class="n">DEFAULT_POLICY_ID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Policy</span><span class="p">:</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span class="sd">&quot;&quot;&quot;Return policy for the specified id, or None.</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="sd">        policy_id: ID of the policy to return.</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">workers</span><span class="o">.</span><span class="n">local_worker</span><span class="p">()</span><span class="o">.</span><span class="n">get_policy</span><span class="p">(</span><span class="n">policy_id</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.get_weights">
<code class="highlight language-python"><span class="n">get_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">policies</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Return a dictionary of policy ids to weights.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>policies</code></td>
        <td><code>Optional[List[str]]</code></td>
        <td><p>Optional list of policies to return weights for,
or None for all policies.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@PublicAPI</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">def</span> <span class="nf">get_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">policies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PolicyID</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span class="sd">&quot;&quot;&quot;Return a dictionary of policy ids to weights.</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="sd">        policies: Optional list of policies to return weights for,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="sd">            or None for all policies.</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">workers</span><span class="o">.</span><span class="n">local_worker</span><span class="p">()</span><span class="o">.</span><span class="n">get_weights</span><span class="p">(</span><span class="n">policies</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.import_model">
<code class="highlight language-python"><span class="n">import_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">import_file</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Imports a model from import_file.</p>
<p>Note: Currently, only h5 files are supported.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>import_file</code></td>
        <td><code>str</code></td>
        <td><p>The file to import the model from.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>A dict that maps ExportFormats to successfully exported models.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">def</span> <span class="nf">import_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">import_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>    <span class="sd">&quot;&quot;&quot;Imports a model from import_file.</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="sd">    Note: Currently, only h5 files are supported.</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="sd">        import_file (str): The file to import the model from.</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">        A dict that maps ExportFormats to successfully exported models.</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>    <span class="c1"># Check for existence.</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">import_file</span><span class="p">):</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>            <span class="s2">&quot;`import_file` &#39;</span><span class="si">{}</span><span class="s2">&#39; does not exist! Can&#39;t import Model.&quot;</span><span class="o">.</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>            <span class="nb">format</span><span class="p">(</span><span class="n">import_file</span><span class="p">))</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="c1"># Get the format of the given file.</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="n">import_format</span> <span class="o">=</span> <span class="s2">&quot;h5&quot;</span>  <span class="c1"># TODO(sven): Support checkpoint loading.</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="n">ExportFormat</span><span class="o">.</span><span class="n">validate</span><span class="p">([</span><span class="n">import_format</span><span class="p">])</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="k">if</span> <span class="n">import_format</span> <span class="o">!=</span> <span class="n">ExportFormat</span><span class="o">.</span><span class="n">H5</span><span class="p">:</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_policy_model_from_h5</span><span class="p">(</span><span class="n">import_file</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.import_policy_model_from_h5">
<code class="highlight language-python"><span class="n">import_policy_model_from_h5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">import_file</span><span class="p">,</span> <span class="n">policy_id</span><span class="o">=</span><span class="s1">&#39;default_policy&#39;</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Imports a policy's model with given policy_id from a local h5 file.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>import_file</code></td>
        <td><code>str</code></td>
        <td><p>The h5 file to import from.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>policy_id</code></td>
        <td><code>str</code></td>
        <td><p>Optional policy id to import into.</p></td>
        <td><code>&#39;default_policy&#39;</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">trainer</span> <span class="o">=</span> <span class="n">MyTrainer</span><span class="p">()</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">trainer</span><span class="o">.</span><span class="n">import_policy_model_from_h5</span><span class="p">(</span><span class="s2">&quot;/tmp/weights.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="o">&gt;&gt;&gt;</span>     <span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@DeveloperAPI</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">def</span> <span class="nf">import_policy_model_from_h5</span><span class="p">(</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>        <span class="n">import_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>        <span class="n">policy_id</span><span class="p">:</span> <span class="n">PolicyID</span> <span class="o">=</span> <span class="n">DEFAULT_POLICY_ID</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>    <span class="sd">&quot;&quot;&quot;Imports a policy&#39;s model with given policy_id from a local h5 file.</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">        import_file: The h5 file to import from.</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">        policy_id: Optional policy id to import into.</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">        &gt;&gt;&gt; trainer = MyTrainer()</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">        &gt;&gt;&gt; trainer.import_policy_model_from_h5(&quot;/tmp/weights.h5&quot;)</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">        &gt;&gt;&gt; for _ in range(10):</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">        &gt;&gt;&gt;     trainer.train()</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">get_policy</span><span class="p">(</span><span class="n">policy_id</span><span class="p">)</span><span class="o">.</span><span class="n">import_model_from_h5</span><span class="p">(</span><span class="n">import_file</span><span class="p">)</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="c1"># Sync new weights to remote workers.</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_sync_weights_to_workers</span><span class="p">(</span><span class="n">worker_set</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workers</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.load_checkpoint">
<code class="highlight language-python"><span class="n">load_checkpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checkpoint_path</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Subclasses should override this to implement restore().</p>
<p>!!! warning
    In this method, do not rely on absolute paths. The absolute
    path of the checkpoint_dir used in <code>Trainable.save_checkpoint</code>
    may be changed.</p>
<p>If <code>Trainable.save_checkpoint</code> returned a prefixed string, the
prefix of the checkpoint string returned by
<code>Trainable.save_checkpoint</code> may be changed.
This is because trial pausing depends on temporary directories.</p>
<p>The directory structure under the checkpoint_dir provided to
<code>Trainable.save_checkpoint</code> is preserved.</p>
<p>See the example below.</p>
<p>.. code-block:: python</p>
<div class="highlight"><pre><span></span><code>class Example(Trainable):
    def save_checkpoint(self, checkpoint_path):
        print(checkpoint_path)
        return os.path.join(checkpoint_path, &quot;my/check/point&quot;)

    def load_checkpoint(self, checkpoint):
        print(checkpoint)

&gt;&gt;&gt; trainer = Example()
&gt;&gt;&gt; obj = trainer.save_to_object()  # This is used when PAUSED.
&lt;logdir&gt;/tmpc8k_c_6hsave_to_object/checkpoint_0/my/check/point
&gt;&gt;&gt; trainer.restore_from_object(obj)  # Note the different prefix.
&lt;logdir&gt;/tmpb87b5axfrestore_from_object/checkpoint_0/my/check/point
</code></pre></div>
<p>.. versionadded:: 0.8.7</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>checkpoint</code></td>
        <td><code>str|dict</code></td>
        <td><p>If dict, the return value is as
returned by <code>save_checkpoint</code>. If a string, then it is
a checkpoint path that may have a different prefix than that
returned by <code>save_checkpoint</code>. The directory structure
underneath the <code>checkpoint_dir</code> <code>save_checkpoint</code> is preserved.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@override</span><span class="p">(</span><span class="n">Trainable</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">def</span> <span class="nf">load_checkpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checkpoint_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span class="n">extra_data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">checkpoint_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">__setstate__</span><span class="p">(</span><span class="n">extra_data</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.log_result">
<code class="highlight language-python"><span class="n">log_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Subclasses can optionally override this to customize logging.</p>
<p>The logging here is done on the worker process rather than
the driver. You may want to turn off driver logging via the
<code>loggers</code> parameter in <code>tune.run</code> when overriding this function.</p>
<p>.. versionadded:: 0.8.7</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>result</code></td>
        <td><code>dict</code></td>
        <td><p>Training result returned by step().</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@override</span><span class="p">(</span><span class="n">Trainable</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">def</span> <span class="nf">log_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">ResultDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span class="c1"># Log after the callback is invoked, so that the user has a chance</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>    <span class="c1"># to mutate the result.</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">on_train_result</span><span class="p">(</span><span class="n">trainer</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>    <span class="c1"># Then log according to Trainable&#39;s logging logic.</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>    <span class="n">Trainable</span><span class="o">.</span><span class="n">log_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.remove_policy">
<code class="highlight language-python"><span class="n">remove_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">policy_id</span><span class="o">=</span><span class="s1">&#39;default_policy&#39;</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">policy_mapping_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">policies_to_train</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">evaluation_workers</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Removes a new policy from this Trainer.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>policy_id</code></td>
        <td><code>Optional[PolicyID]</code></td>
        <td><p>ID of the policy to be removed.</p></td>
        <td><code>&#39;default_policy&#39;</code></td>
      </tr>
      <tr>
        <td><code>policy_mapping_fn</code></td>
        <td><code>Optional[Callable[[AgentID], PolicyID]]</code></td>
        <td><p>An
optional (updated) policy mapping function to use from here on.
Note that already ongoing episodes will not change their
mapping but will use the old mapping till the end of the
episode.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>policies_to_train</code></td>
        <td><code>Optional[List[PolicyID]]</code></td>
        <td><p>An optional list of
policy IDs to be trained. If None, will keep the existing list
in place. Policies, whose IDs are not in the list will not be
updated.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>evaluation_workers</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to also remove the policy from
the evaluation WorkerSet.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@PublicAPI</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">def</span> <span class="nf">remove_policy</span><span class="p">(</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>        <span class="n">policy_id</span><span class="p">:</span> <span class="n">PolicyID</span> <span class="o">=</span> <span class="n">DEFAULT_POLICY_ID</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>        <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>        <span class="n">policy_mapping_fn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">AgentID</span><span class="p">],</span> <span class="n">PolicyID</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>        <span class="n">policies_to_train</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PolicyID</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>        <span class="n">evaluation_workers</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>    <span class="sd">&quot;&quot;&quot;Removes a new policy from this Trainer.</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">        policy_id (Optional[PolicyID]): ID of the policy to be removed.</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">        policy_mapping_fn (Optional[Callable[[AgentID], PolicyID]]): An</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">            optional (updated) policy mapping function to use from here on.</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">            Note that already ongoing episodes will not change their</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">            mapping but will use the old mapping till the end of the</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">            episode.</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">        policies_to_train (Optional[List[PolicyID]]): An optional list of</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">            policy IDs to be trained. If None, will keep the existing list</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">            in place. Policies, whose IDs are not in the list will not be</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">            updated.</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">        evaluation_workers (bool): Whether to also remove the policy from</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">            the evaluation WorkerSet.</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="k">def</span> <span class="nf">fn</span><span class="p">(</span><span class="n">worker</span><span class="p">):</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>        <span class="n">worker</span><span class="o">.</span><span class="n">remove_policy</span><span class="p">(</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>            <span class="n">policy_id</span><span class="o">=</span><span class="n">policy_id</span><span class="p">,</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>            <span class="n">policy_mapping_fn</span><span class="o">=</span><span class="n">policy_mapping_fn</span><span class="p">,</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>            <span class="n">policies_to_train</span><span class="o">=</span><span class="n">policies_to_train</span><span class="p">,</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>        <span class="p">)</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">workers</span><span class="o">.</span><span class="n">foreach_worker</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="k">if</span> <span class="n">evaluation_workers</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_workers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_workers</span><span class="o">.</span><span class="n">foreach_worker</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.resource_help">
<code class="highlight language-python"><span class="n">resource_help</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>Returns a help string for configuring this trainable's resources.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>config</code></td>
        <td><code>dict</code></td>
        <td><p>The Trainer's config dict.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="nd">@override</span><span class="p">(</span><span class="n">Trainable</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="k">def</span> <span class="nf">resource_help</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">TrainerConfigDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>    <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">You can adjust the resource requests of RLlib agents by &quot;</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>            <span class="s2">&quot;setting `num_workers`, `num_gpus`, and other configs. See &quot;</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>            <span class="s2">&quot;the DEFAULT_CONFIG defined by each agent for more info.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>            <span class="s2">&quot;The config of this agent is: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">config</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.save_checkpoint">
<code class="highlight language-python"><span class="n">save_checkpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checkpoint_dir</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Subclasses should override this to implement <code>save()</code>.</p>
<p>!!! warning
    Do not rely on absolute paths in the implementation of
    <code>Trainable.save_checkpoint</code> and <code>Trainable.load_checkpoint</code>.</p>
<p>Use <code>validate_save_restore</code> to catch <code>Trainable.save_checkpoint</code>/
<code>Trainable.load_checkpoint</code> errors before execution.</p>
<blockquote>
<blockquote>
<blockquote>
<p>from ray.tune.utils import validate_save_restore
validate_save_restore(MyTrainableClass)
validate_save_restore(MyTrainableClass, use_object_store=True)</p>
</blockquote>
</blockquote>
</blockquote>
<p>.. versionadded:: 0.8.7</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>tmp_checkpoint_dir</code></td>
        <td><code>str</code></td>
        <td><p>The directory where the checkpoint
file must be stored. In a Tune run, if the trial is paused,
the provided path may be temporary and moved.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>A dict or string. If string, the return value is expected to be
prefixed by <code>tmp_checkpoint_dir</code>. If dict, the return value will
be automatically serialized by Tune and
passed to <code>Trainable.load_checkpoint()</code>.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">trainable1</span><span class="o">.</span><span class="n">save_checkpoint</span><span class="p">(</span><span class="s2">&quot;/tmp/checkpoint_1&quot;</span><span class="p">))</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="s2">&quot;/tmp/checkpoint_1/my_checkpoint_file&quot;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">trainable2</span><span class="o">.</span><span class="n">save_checkpoint</span><span class="p">(</span><span class="s2">&quot;/tmp/checkpoint_2&quot;</span><span class="p">))</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="p">{</span><span class="s2">&quot;some&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">}</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">trainable</span><span class="o">.</span><span class="n">save_checkpoint</span><span class="p">(</span><span class="s2">&quot;/tmp/bad_example&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="s2">&quot;/tmp/NEW_CHECKPOINT_PATH/my_checkpoint_file&quot;</span> <span class="c1"># This will error.</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@override</span><span class="p">(</span><span class="n">Trainable</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">def</span> <span class="nf">save_checkpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checkpoint_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span class="n">checkpoint_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">checkpoint_dir</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>                                   <span class="s2">&quot;checkpoint-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iteration</span><span class="p">))</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__getstate__</span><span class="p">(),</span> <span class="nb">open</span><span class="p">(</span><span class="n">checkpoint_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>    <span class="k">return</span> <span class="n">checkpoint_path</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.set_weights">
<code class="highlight language-python"><span class="n">set_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Set policy weights by policy id.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>weights</code></td>
        <td><code>Dict[str, dict]</code></td>
        <td><p>Map of policy ids to weights to set.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@PublicAPI</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">def</span> <span class="nf">set_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">PolicyID</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]):</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span class="sd">&quot;&quot;&quot;Set policy weights by policy id.</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="sd">        weights: Map of policy ids to weights to set.</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">workers</span><span class="o">.</span><span class="n">local_worker</span><span class="p">()</span><span class="o">.</span><span class="n">set_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.setup">
<code class="highlight language-python"><span class="n">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Subclasses should override this for custom initialization.</p>
<p>.. versionadded:: 0.8.7</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>config</code></td>
        <td><code>dict</code></td>
        <td><p>Hyperparameters and other configs given.
Copy of <code>self.config</code>.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@override</span><span class="p">(</span><span class="n">Trainable</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">PartialTrainerConfigDict</span><span class="p">):</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>    <span class="c1"># Setup our config: Merge the user-supplied config (which could</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>    <span class="c1"># be a partial config dict with the class&#39; default).</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge_trainer_configs</span><span class="p">(</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_default_config</span><span class="p">(),</span> <span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allow_unknown_configs</span><span class="p">)</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>    <span class="c1"># Setup the &quot;env creator&quot; callable.</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>    <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env_id</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>    <span class="k">if</span> <span class="n">env</span><span class="p">:</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;env&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>        <span class="c1"># An already registered env.</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>        <span class="k">if</span> <span class="n">_global_registry</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">ENV_CREATOR</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">env_creator</span> <span class="o">=</span> <span class="n">_global_registry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ENV_CREATOR</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>        <span class="c1"># A class path specifier.</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>        <span class="k">elif</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">env</span><span class="p">:</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>            <span class="k">def</span> <span class="nf">env_creator_from_classpath</span><span class="p">(</span><span class="n">env_context</span><span class="p">):</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>                    <span class="n">env_obj</span> <span class="o">=</span> <span class="n">from_config</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">env_context</span><span class="p">)</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>                    <span class="k">raise</span> <span class="n">EnvError</span><span class="p">(</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>                        <span class="n">ERR_MSG_INVALID_ENV_DESCRIPTOR</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="p">))</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>                <span class="k">return</span> <span class="n">env_obj</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">env_creator</span> <span class="o">=</span> <span class="n">env_creator_from_classpath</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>        <span class="c1"># Try gym/PyBullet/Vizdoom.</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">env_creator</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>                <span class="n">gym_env_creator</span><span class="p">,</span> <span class="n">env_descriptor</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="c1"># No env -&gt; Env creator always returns None.</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">env_creator</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">env_config</span><span class="p">:</span> <span class="kc">None</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="c1"># Check and resolve DL framework settings.</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="c1"># Tf-eager (tf2|tfe), possibly with tracing set to True. Recommend</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="c1"># setting tracing to True for speedups.</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="k">if</span> <span class="n">tf1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;framework&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;tf2&quot;</span><span class="p">,</span> <span class="s2">&quot;tfe&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;framework&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;tf2&quot;</span> <span class="ow">and</span> <span class="n">tfv</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>                <span class="s2">&quot;You configured `framework`=tf2, but your installed pip &quot;</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>                <span class="s2">&quot;tf-version is &lt; 2.0! Make sure your TensorFlow version &quot;</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>                <span class="s2">&quot;is &gt;= 2.x.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">tf1</span><span class="o">.</span><span class="n">executing_eagerly</span><span class="p">():</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>            <span class="n">tf1</span><span class="o">.</span><span class="n">enable_eager_execution</span><span class="p">()</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>            <span class="sa">f</span><span class="s2">&quot;Executing eagerly (framework=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;framework&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;),&quot;</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>            <span class="sa">f</span><span class="s2">&quot; with eager_tracing=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;eager_tracing&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. For &quot;</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>            <span class="s2">&quot;production workloads, make sure to set `eager_tracing=True` &quot;</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>            <span class="s2">&quot;in order to match the speed of tf-static-graph &quot;</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>            <span class="s2">&quot;(framework=&#39;tf&#39;). For debugging purposes, &quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>            <span class="s2">&quot;`eager_tracing=False` is the best choice.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="c1"># Tf-static-graph (framework=tf): Recommend upgrading to tf2 and</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="c1"># enabling eager tracing for similar speed.</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="k">elif</span> <span class="n">tf1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;framework&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;tf&quot;</span><span class="p">:</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>            <span class="s2">&quot;Your framework setting is &#39;tf&#39;, meaning you are using static&quot;</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="s2">&quot;-graph mode. Set framework=&#39;tf2&#39; to enable eager execution &quot;</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>            <span class="s2">&quot;with tf2.x. You may also want to then set &quot;</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="s2">&quot;`eager_tracing=True` in order to reach similar execution &quot;</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>            <span class="s2">&quot;speed as with static-graph mode.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="c1"># Set Trainer&#39;s seed after we have - if necessary - enabled</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="c1"># tf eager-execution.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="n">update_global_seed_if_necessary</span><span class="p">(</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;framework&quot;</span><span class="p">),</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;seed&quot;</span><span class="p">))</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">trainer_obj_or_none</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;callbacks&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>            <span class="s2">&quot;`callbacks` must be a callable method that &quot;</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>            <span class="s2">&quot;returns a subclass of DefaultCallbacks, got </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;callbacks&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;callbacks&quot;</span><span class="p">]()</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="n">log_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;log_level&quot;</span><span class="p">)</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="k">if</span> <span class="n">log_level</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;WARN&quot;</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Current log_level is </span><span class="si">{}</span><span class="s2">. For more information, &quot;</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>                    <span class="s2">&quot;set &#39;log_level&#39;: &#39;INFO&#39; / &#39;DEBUG&#39; or use the -v and &quot;</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>                    <span class="s2">&quot;-vv flags.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">log_level</span><span class="p">))</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;log_level&quot;</span><span class="p">):</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;ray.rllib&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;log_level&quot;</span><span class="p">])</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="c1"># Create local replay buffer if necessary.</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">local_replay_buffer</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_create_local_replay_buffer_if_necessary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">))</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="c1"># Deprecated way of implementing Trainer sub-classes (or &quot;templates&quot;</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="c1"># via the soon-to-be deprecated `build_trainer` utility function).</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="c1"># Instead, sub-classes should override the Trainable&#39;s `setup()`</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="c1"># method and call super().setup() from within that override at some</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="c1"># point.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">workers</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">train_exec_impl</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="c1"># Old design: Override `Trainer._init` (or use `build_trainer()`, which</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="c1"># will do this for you).</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_creator</span><span class="p">)</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="c1"># New design: Override `Trainable.setup()` (as indented by Trainable)</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="c1"># and do or don&#39;t call super().setup() from within your override.</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="c1"># By default, `super().setup()` will create both worker sets:</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="c1"># &quot;rollout workers&quot; for collecting samples for training and - if</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="c1"># applicable - &quot;evaluation workers&quot; for evaluation runs in between or</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="c1"># parallel to training.</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="c1"># TODO: Deprecate `_init()` and remove this try/except block.</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="c1"># Only if user did not override `_init()`:</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="c1"># - Create rollout workers here automatically.</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="c1"># - Run the execution plan to create the local iterator to `next()`</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="c1">#   in each training iteration.</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="c1"># This matches the behavior of using `build_trainer()`, which</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="c1"># should no longer be used.</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">workers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_workers</span><span class="p">(</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="n">env_creator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">env_creator</span><span class="p">,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="n">validate_env</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validate_env</span><span class="p">,</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="n">policy_class</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_default_policy_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">),</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="n">num_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;num_workers&quot;</span><span class="p">])</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_exec_impl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_plan</span><span class="p">(</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">workers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_kwargs_for_execution_plan</span><span class="p">())</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="c1"># Evaluation WorkerSet setup.</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_workers</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_metrics</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="c1"># User would like to setup a separate evaluation worker set.</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;evaluation_num_workers&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> \
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;evaluation_interval&quot;</span><span class="p">):</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="c1"># Update env_config with evaluation settings:</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="n">extra_config</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;evaluation_config&quot;</span><span class="p">])</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="c1"># Assert that user has not unset &quot;in_evaluation&quot;.</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="k">assert</span> <span class="s2">&quot;in_evaluation&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">extra_config</span> <span class="ow">or</span> \
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>            <span class="n">extra_config</span><span class="p">[</span><span class="s2">&quot;in_evaluation&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="n">evaluation_config</span> <span class="o">=</span> <span class="n">merge_dicts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">extra_config</span><span class="p">)</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="c1"># Validate evaluation config.</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_config</span><span class="p">(</span><span class="n">evaluation_config</span><span class="p">,</span> <span class="n">trainer_obj_or_none</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="c1"># Switch on complete_episode rollouts (evaluations are</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="c1"># always done on n complete episodes) and set the</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="c1"># `in_evaluation` flag. Also, make sure our rollout fragments</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="c1"># are short so we don&#39;t have more than one episode in one rollout.</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="n">evaluation_config</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="s2">&quot;batch_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;complete_episodes&quot;</span><span class="p">,</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="s2">&quot;rollout_fragment_length&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="s2">&quot;in_evaluation&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="p">})</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;using evaluation_config: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">extra_config</span><span class="p">))</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="c1"># Create a separate evaluation worker set for evaluation.</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="c1"># If evaluation_num_workers=0, use the evaluation set&#39;s local</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="c1"># worker for evaluation, otherwise, use its remote workers</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="c1"># (parallelized evaluation).</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_workers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_workers</span><span class="p">(</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>            <span class="n">env_creator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">env_creator</span><span class="p">,</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>            <span class="n">validate_env</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="n">policy_class</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_default_policy_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">),</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="n">config</span><span class="o">=</span><span class="n">evaluation_config</span><span class="p">,</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="n">num_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;evaluation_num_workers&quot;</span><span class="p">])</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.step">
<code class="highlight language-python"><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Implements the main <code>Trainer.train()</code> logic.</p>
<p>Takes n attempts to perform a single training step. Thereby
catches RayErrors resulting from worker failures. After n attempts,
fails gracefully.</p>
<p>Override this method in your Trainer sub-classes if you would like to
handle worker failures yourself. Otherwise, override
<code>self.step_attempt()</code> to keep the n attempts (catch worker failures).</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>dict</code></td>
      <td><p>The results dict with stats/infos on sampling, training,
and - if required - evaluation.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@override</span><span class="p">(</span><span class="n">Trainable</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ResultDict</span><span class="p">:</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span class="sd">&quot;&quot;&quot;Implements the main `Trainer.train()` logic.</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="sd">    Takes n attempts to perform a single training step. Thereby</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="sd">    catches RayErrors resulting from worker failures. After n attempts,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="sd">    fails gracefully.</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">    Override this method in your Trainer sub-classes if you would like to</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">    handle worker failures yourself. Otherwise, override</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">    `self.step_attempt()` to keep the n attempts (catch worker failures).</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">        The results dict with stats/infos on sampling, training,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">        and - if required - evaluation.</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">MAX_WORKER_FAILURE_RETRIES</span><span class="p">):</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>        <span class="c1"># Try to train one step.</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_attempt</span><span class="p">()</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>        <span class="c1"># @ray.remote RolloutWorker failure -&gt; Try to recover,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>        <span class="c1"># if necessary.</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>        <span class="k">except</span> <span class="n">RayError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;ignore_worker_failures&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>                    <span class="s2">&quot;Error in train call, attempting to recover&quot;</span><span class="p">)</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">try_recover_from_step_attempt</span><span class="p">()</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>                    <span class="s2">&quot;Worker crashed during call to train(). To attempt to &quot;</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>                    <span class="s2">&quot;continue training without the failed worker, set &quot;</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>                    <span class="s2">&quot;`&#39;ignore_worker_failures&#39;: True`.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>                <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>        <span class="c1"># Any other exception.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>            <span class="c1"># Allow logs messages to propagate.</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>            <span class="k">break</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="c1"># Still no result (even after n retries).</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Failed to recover from worker crash.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;workers&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workers</span><span class="p">,</span> <span class="n">WorkerSet</span><span class="p">):</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sync_filters_if_needed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workers</span><span class="p">)</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.step_attempt">
<code class="highlight language-python"><span class="n">step_attempt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Attempts a single training step, including evaluation, if required.</p>
<p>Override this method in your Trainer sub-classes if you would like to
keep the n attempts (catch worker failures) or override <code>step()</code>
directly if you would like to handle worker failures yourself.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>dict</code></td>
      <td><p>The results dict with stats/infos on sampling, training,
and - if required - evaluation.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@ExperimentalAPI</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">def</span> <span class="nf">step_attempt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ResultDict</span><span class="p">:</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span class="sd">&quot;&quot;&quot;Attempts a single training step, including evaluation, if required.</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="sd">    Override this method in your Trainer sub-classes if you would like to</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="sd">    keep the n attempts (catch worker failures) or override `step()`</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="sd">    directly if you would like to handle worker failures yourself.</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">        The results dict with stats/infos on sampling, training,</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">        and - if required - evaluation.</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>    <span class="c1"># self._iteration gets incremented after this function returns,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>    <span class="c1"># meaning that e. g. the first time this function is called,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>    <span class="c1"># self._iteration will be 0.</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="n">evaluate_this_iter</span> <span class="o">=</span> \
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;evaluation_interval&quot;</span><span class="p">]</span> <span class="ow">and</span> \
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;evaluation_interval&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="c1"># No evaluation necessary, just run the next training iteration.</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">evaluate_this_iter</span><span class="p">:</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>        <span class="n">step_results</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_exec_impl</span><span class="p">)</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="c1"># We have to evaluate in this training iteration.</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>        <span class="c1"># No parallelism.</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;evaluation_parallel_to_training&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>            <span class="n">step_results</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_exec_impl</span><span class="p">)</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>        <span class="c1"># Kick off evaluation-loop (and parallel train() call,</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>        <span class="c1"># if requested).</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>        <span class="c1"># Parallel eval + training.</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;evaluation_parallel_to_training&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>            <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>                <span class="n">train_future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>                    <span class="k">lambda</span><span class="p">:</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_exec_impl</span><span class="p">))</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;evaluation_num_episodes&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>                    <span class="c1"># Run at least one `evaluate()` (num_episodes_done</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>                    <span class="c1"># must be &gt; 0), even if the training is very fast.</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>                    <span class="k">def</span> <span class="nf">episodes_left_fn</span><span class="p">(</span><span class="n">num_episodes_done</span><span class="p">):</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>                        <span class="k">if</span> <span class="n">num_episodes_done</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> \
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>                                <span class="n">train_future</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>                            <span class="k">return</span> <span class="mi">0</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>                        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>                            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;evaluation_num_workers&quot;</span><span class="p">]</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>                    <span class="n">evaluation_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>                        <span class="n">episodes_left_fn</span><span class="o">=</span><span class="n">episodes_left_fn</span><span class="p">)</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>                    <span class="n">evaluation_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>                <span class="c1"># Collect the training results from the future.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>                <span class="n">step_results</span> <span class="o">=</span> <span class="n">train_future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="c1"># Sequential: train (already done above), then eval.</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>            <span class="n">evaluation_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="c1"># Add evaluation results to train results.</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">evaluation_metrics</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span> \
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>            <span class="s2">&quot;Trainer.evaluate() needs to return a dict.&quot;</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="n">step_results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">evaluation_metrics</span><span class="p">)</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="c1"># Check `env_task_fn` for possible update of the env&#39;s task.</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;env_task_fn&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;env_task_fn&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>                <span class="s2">&quot;`env_task_fn` must be None or a callable taking &quot;</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>                <span class="s2">&quot;[train_results, env, env_ctx] as args!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="k">def</span> <span class="nf">fn</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">env_context</span><span class="p">,</span> <span class="n">task_fn</span><span class="p">):</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>            <span class="n">new_task</span> <span class="o">=</span> <span class="n">task_fn</span><span class="p">(</span><span class="n">step_results</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">env_context</span><span class="p">)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>            <span class="n">cur_task</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get_task</span><span class="p">()</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>            <span class="k">if</span> <span class="n">cur_task</span> <span class="o">!=</span> <span class="n">new_task</span><span class="p">:</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>                <span class="n">env</span><span class="o">.</span><span class="n">set_task</span><span class="p">(</span><span class="n">new_task</span><span class="p">)</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="n">fn</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">task_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;env_task_fn&quot;</span><span class="p">])</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">workers</span><span class="o">.</span><span class="n">foreach_env_with_context</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="k">return</span> <span class="n">step_results</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.try_recover_from_step_attempt">
<code class="highlight language-python"><span class="n">try_recover_from_step_attempt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Try to identify and remove any unhealthy workers.</p>
<p>This method is called after an unexpected remote error is encountered
from a worker during the call to <code>self.step_attempt()</code> (within
<code>self.step()</code>). It issues check requests to all current workers and
removes any that respond with error. If no healthy workers remain,
an error is raised. Otherwise, tries to re-build the execution plan
with the remaining (healthy) workers.</p>

        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">def</span> <span class="nf">try_recover_from_step_attempt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>    <span class="sd">&quot;&quot;&quot;Try to identify and remove any unhealthy workers.</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="sd">    This method is called after an unexpected remote error is encountered</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="sd">    from a worker during the call to `self.step_attempt()` (within</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="sd">    `self.step()`). It issues check requests to all current workers and</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="sd">    removes any that respond with error. If no healthy workers remain,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="sd">    an error is raised. Otherwise, tries to re-build the execution plan</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">    with the remaining (healthy) workers.</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>    <span class="n">workers</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;workers&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">workers</span><span class="p">,</span> <span class="n">WorkerSet</span><span class="p">):</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>        <span class="k">return</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Health checking all workers...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="n">checks</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="k">for</span> <span class="n">ev</span> <span class="ow">in</span> <span class="n">workers</span><span class="o">.</span><span class="n">remote_workers</span><span class="p">():</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>        <span class="n">_</span><span class="p">,</span> <span class="n">obj_ref</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">sample_with_count</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>        <span class="n">checks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj_ref</span><span class="p">)</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="n">healthy_workers</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obj_ref</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">checks</span><span class="p">):</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>        <span class="n">w</span> <span class="o">=</span> <span class="n">workers</span><span class="o">.</span><span class="n">remote_workers</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>            <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj_ref</span><span class="p">)</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>            <span class="n">healthy_workers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Worker </span><span class="si">{}</span><span class="s2"> looks healthy&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>        <span class="k">except</span> <span class="n">RayError</span><span class="p">:</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Removing unhealthy worker </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>                <span class="n">w</span><span class="o">.</span><span class="n">__ray_terminate__</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error terminating unhealthy worker&quot;</span><span class="p">)</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">healthy_workers</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>            <span class="s2">&quot;Not enough healthy workers remain to continue.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Recreating execution plan after failure.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="n">workers</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">healthy_workers</span><span class="p">)</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_exec_impl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_plan</span><span class="p">):</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">train_exec_impl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_plan</span><span class="p">(</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>                <span class="n">workers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_kwargs_for_execution_plan</span><span class="p">())</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.trainer.Trainer.validate_env">
<code class="highlight language-python"><span class="n">validate_env</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">env_context</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>Env validator function for this Trainer class.</p>
<p>Override this in child classes to define custom validation
behavior.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>env</code></td>
        <td><code>Any</code></td>
        <td><p>The (sub-)environment to validate. This is normally a
single sub-environment (e.g. a gym.Env) within a vectorized
setup.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>env_context</code></td>
        <td><code>EnvContext</code></td>
        <td><p>The EnvContext to configure the environment.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/trainer.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@ExperimentalAPI</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="k">def</span> <span class="nf">validate_env</span><span class="p">(</span><span class="n">env</span><span class="p">:</span> <span class="n">EnvType</span><span class="p">,</span> <span class="n">env_context</span><span class="p">:</span> <span class="n">EnvContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>    <span class="sd">&quot;&quot;&quot;Env validator function for this Trainer class.</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="sd">    Override this in child classes to define custom validation</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="sd">    behavior.</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">        env: The (sub-)environment to validate. This is normally a</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">            single sub-environment (e.g. a gym.Env) within a vectorized</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">            setup.</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">        env_context: The EnvContext to configure the environment.</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">        Exception in case something is wrong with the given environment.</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="k">pass</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="ray.rllib.agents.callbacks.DefaultCallbacks">
        <code>
ray.rllib.agents.callbacks.DefaultCallbacks        </code>



</h2>

    <div class="doc doc-contents first">

      <p>Abstract base class for RLlib callbacks (similar to Keras callbacks).</p>
<p>These callbacks can be used for custom metrics and custom postprocessing.</p>
<p>By default, all of these callbacks are no-ops. To configure custom training
callbacks, subclass DefaultCallbacks and then set
{"callbacks": YourCallbacksClass} in the trainer config.</p>




  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.callbacks.DefaultCallbacks.on_episode_end">
<code class="highlight language-python"><span class="n">on_episode_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">worker</span><span class="p">,</span> <span class="n">base_env</span><span class="p">,</span> <span class="n">policies</span><span class="p">,</span> <span class="n">episode</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Runs when an episode is done.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>worker</code></td>
        <td><code>RolloutWorker</code></td>
        <td><p>Reference to the current rollout worker.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>base_env</code></td>
        <td><code>BaseEnv</code></td>
        <td><p>BaseEnv running the episode. The underlying
sub environment objects can be retrieved by calling
<code>base_env.get_sub_environments()</code>.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>policies</code></td>
        <td><code>Dict[str, ray.rllib.policy.policy.Policy]</code></td>
        <td><p>Mapping of policy id to policy
objects. In single agent mode there will only be a single
"default_policy".</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>episode</code></td>
        <td><code>Episode</code></td>
        <td><p>Episode object which contains episode
state. You can use the <code>episode.user_data</code> dict to store
temporary data, and <code>episode.custom_metrics</code> to store custom
metrics for the episode.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>kwargs</code></td>
        <td></td>
        <td><p>Forward compatibility placeholder.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/callbacks.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">def</span> <span class="nf">on_episode_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">worker</span><span class="p">:</span> <span class="s2">&quot;RolloutWorker&quot;</span><span class="p">,</span> <span class="n">base_env</span><span class="p">:</span> <span class="n">BaseEnv</span><span class="p">,</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>                   <span class="n">policies</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">PolicyID</span><span class="p">,</span> <span class="n">Policy</span><span class="p">],</span> <span class="n">episode</span><span class="p">:</span> <span class="n">Episode</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>                   <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>    <span class="sd">&quot;&quot;&quot;Runs when an episode is done.</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="sd">        worker: Reference to the current rollout worker.</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="sd">        base_env: BaseEnv running the episode. The underlying</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">            sub environment objects can be retrieved by calling</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">            `base_env.get_sub_environments()`.</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">        policies: Mapping of policy id to policy</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">            objects. In single agent mode there will only be a single</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">            &quot;default_policy&quot;.</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">        episode: Episode object which contains episode</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">            state. You can use the `episode.user_data` dict to store</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">            temporary data, and `episode.custom_metrics` to store custom</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">            metrics for the episode.</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">        kwargs: Forward compatibility placeholder.</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_callbacks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;on_episode_end&quot;</span><span class="p">):</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">legacy_callbacks</span><span class="p">[</span><span class="s2">&quot;on_episode_end&quot;</span><span class="p">]({</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>            <span class="s2">&quot;env&quot;</span><span class="p">:</span> <span class="n">base_env</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>            <span class="s2">&quot;policy&quot;</span><span class="p">:</span> <span class="n">policies</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>            <span class="s2">&quot;episode&quot;</span><span class="p">:</span> <span class="n">episode</span><span class="p">,</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>        <span class="p">})</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.callbacks.DefaultCallbacks.on_episode_start">
<code class="highlight language-python"><span class="n">on_episode_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">worker</span><span class="p">,</span> <span class="n">base_env</span><span class="p">,</span> <span class="n">policies</span><span class="p">,</span> <span class="n">episode</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Callback run on the rollout worker before each episode starts.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>worker</code></td>
        <td><code>RolloutWorker</code></td>
        <td><p>Reference to the current rollout worker.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>base_env</code></td>
        <td><code>BaseEnv</code></td>
        <td><p>BaseEnv running the episode. The underlying
sub environment objects can be retrieved by calling
<code>base_env.get_sub_environments()</code>.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>policies</code></td>
        <td><code>Dict[str, ray.rllib.policy.policy.Policy]</code></td>
        <td><p>Mapping of policy id to policy objects. In single
agent mode there will only be a single "default" policy.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>episode</code></td>
        <td><code>Episode</code></td>
        <td><p>Episode object which contains the episode's
state. You can use the <code>episode.user_data</code> dict to store
temporary data, and <code>episode.custom_metrics</code> to store custom
metrics for the episode.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>kwargs</code></td>
        <td></td>
        <td><p>Forward compatibility placeholder.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/callbacks.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">def</span> <span class="nf">on_episode_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">worker</span><span class="p">:</span> <span class="s2">&quot;RolloutWorker&quot;</span><span class="p">,</span> <span class="n">base_env</span><span class="p">:</span> <span class="n">BaseEnv</span><span class="p">,</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>                     <span class="n">policies</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">PolicyID</span><span class="p">,</span> <span class="n">Policy</span><span class="p">],</span> <span class="n">episode</span><span class="p">:</span> <span class="n">Episode</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>                     <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>    <span class="sd">&quot;&quot;&quot;Callback run on the rollout worker before each episode starts.</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="sd">        worker: Reference to the current rollout worker.</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="sd">        base_env: BaseEnv running the episode. The underlying</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">            sub environment objects can be retrieved by calling</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">            `base_env.get_sub_environments()`.</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">        policies: Mapping of policy id to policy objects. In single</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">            agent mode there will only be a single &quot;default&quot; policy.</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">        episode: Episode object which contains the episode&#39;s</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">            state. You can use the `episode.user_data` dict to store</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">            temporary data, and `episode.custom_metrics` to store custom</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">            metrics for the episode.</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">        kwargs: Forward compatibility placeholder.</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_callbacks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;on_episode_start&quot;</span><span class="p">):</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">legacy_callbacks</span><span class="p">[</span><span class="s2">&quot;on_episode_start&quot;</span><span class="p">]({</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>            <span class="s2">&quot;env&quot;</span><span class="p">:</span> <span class="n">base_env</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>            <span class="s2">&quot;policy&quot;</span><span class="p">:</span> <span class="n">policies</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>            <span class="s2">&quot;episode&quot;</span><span class="p">:</span> <span class="n">episode</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>        <span class="p">})</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.callbacks.DefaultCallbacks.on_episode_step">
<code class="highlight language-python"><span class="n">on_episode_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">worker</span><span class="p">,</span> <span class="n">base_env</span><span class="p">,</span> <span class="n">policies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">episode</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Runs on each episode step.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>worker</code></td>
        <td><code>RolloutWorker</code></td>
        <td><p>Reference to the current rollout worker.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>base_env</code></td>
        <td><code>BaseEnv</code></td>
        <td><p>BaseEnv running the episode. The underlying
sub environment objects can be retrieved by calling
<code>base_env.get_sub_environments()</code>.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>policies</code></td>
        <td><code>Optional[Dict[str, ray.rllib.policy.policy.Policy]]</code></td>
        <td><p>Mapping of policy id
to policy objects. In single agent mode there will only be a
single "default_policy".</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>episode</code></td>
        <td><code>Episode</code></td>
        <td><p>Episode object which contains episode
state. You can use the <code>episode.user_data</code> dict to store
temporary data, and <code>episode.custom_metrics</code> to store custom
metrics for the episode.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>kwargs</code></td>
        <td></td>
        <td><p>Forward compatibility placeholder.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/callbacks.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">def</span> <span class="nf">on_episode_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>                    <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>                    <span class="n">worker</span><span class="p">:</span> <span class="s2">&quot;RolloutWorker&quot;</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>                    <span class="n">base_env</span><span class="p">:</span> <span class="n">BaseEnv</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>                    <span class="n">policies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">PolicyID</span><span class="p">,</span> <span class="n">Policy</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>                    <span class="n">episode</span><span class="p">:</span> <span class="n">Episode</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>                    <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>    <span class="sd">&quot;&quot;&quot;Runs on each episode step.</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">        worker: Reference to the current rollout worker.</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">        base_env: BaseEnv running the episode. The underlying</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">            sub environment objects can be retrieved by calling</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">            `base_env.get_sub_environments()`.</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">        policies: Mapping of policy id</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">            to policy objects. In single agent mode there will only be a</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">            single &quot;default_policy&quot;.</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">        episode: Episode object which contains episode</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">            state. You can use the `episode.user_data` dict to store</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">            temporary data, and `episode.custom_metrics` to store custom</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">            metrics for the episode.</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">        kwargs: Forward compatibility placeholder.</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_callbacks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;on_episode_step&quot;</span><span class="p">):</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">legacy_callbacks</span><span class="p">[</span><span class="s2">&quot;on_episode_step&quot;</span><span class="p">]({</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>            <span class="s2">&quot;env&quot;</span><span class="p">:</span> <span class="n">base_env</span><span class="p">,</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>            <span class="s2">&quot;episode&quot;</span><span class="p">:</span> <span class="n">episode</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>        <span class="p">})</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.callbacks.DefaultCallbacks.on_learn_on_batch">
<code class="highlight language-python"><span class="n">on_learn_on_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">policy</span><span class="p">,</span> <span class="n">train_batch</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Called at the beginning of Policy.learn_on_batch().</p>
<p>Note: This is called before 0-padding via
<code>pad_batch_to_sequences_of_same_size</code>.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>policy</code></td>
        <td><code>Policy</code></td>
        <td><p>Reference to the current Policy object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>train_batch</code></td>
        <td><code>SampleBatch</code></td>
        <td><p>SampleBatch to be trained on. You can
mutate this object to modify the samples generated.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>result</code></td>
        <td><code>dict</code></td>
        <td><p>A results dict to add custom metrics to.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>kwargs</code></td>
        <td></td>
        <td><p>Forward compatibility placeholder.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/callbacks.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">def</span> <span class="nf">on_learn_on_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">policy</span><span class="p">:</span> <span class="n">Policy</span><span class="p">,</span> <span class="n">train_batch</span><span class="p">:</span> <span class="n">SampleBatch</span><span class="p">,</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>                      <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span class="sd">&quot;&quot;&quot;Called at the beginning of Policy.learn_on_batch().</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="sd">    Note: This is called before 0-padding via</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="sd">    `pad_batch_to_sequences_of_same_size`.</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">        policy: Reference to the current Policy object.</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">        train_batch: SampleBatch to be trained on. You can</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">            mutate this object to modify the samples generated.</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">        result: A results dict to add custom metrics to.</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">        kwargs: Forward compatibility placeholder.</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>    <span class="k">pass</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.callbacks.DefaultCallbacks.on_postprocess_trajectory">
<code class="highlight language-python"><span class="n">on_postprocess_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">worker</span><span class="p">,</span> <span class="n">episode</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">,</span> <span class="n">policy_id</span><span class="p">,</span> <span class="n">policies</span><span class="p">,</span> <span class="n">postprocessed_batch</span><span class="p">,</span> <span class="n">original_batches</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Called immediately after a policy's postprocess_fn is called.</p>
<p>You can use this callback to do additional postprocessing for a policy,
including looking at the trajectory data of other agents in multi-agent
settings.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>worker</code></td>
        <td><code>RolloutWorker</code></td>
        <td><p>Reference to the current rollout worker.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>episode</code></td>
        <td><code>Episode</code></td>
        <td><p>Episode object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>agent_id</code></td>
        <td><code>Any</code></td>
        <td><p>Id of the current agent.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>policy_id</code></td>
        <td><code>str</code></td>
        <td><p>Id of the current policy for the agent.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>policies</code></td>
        <td><code>Dict[str, ray.rllib.policy.policy.Policy]</code></td>
        <td><p>Mapping of policy id to policy objects. In single
agent mode there will only be a single "default_policy".</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>postprocessed_batch</code></td>
        <td><code>SampleBatch</code></td>
        <td><p>The postprocessed sample batch
for this agent. You can mutate this object to apply your own
trajectory postprocessing.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>original_batches</code></td>
        <td><code>Dict[Any, ray.rllib.policy.sample_batch.SampleBatch]</code></td>
        <td><p>Mapping of agents to their unpostprocessed
trajectory data. You should not mutate this object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>kwargs</code></td>
        <td></td>
        <td><p>Forward compatibility placeholder.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/callbacks.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">def</span> <span class="nf">on_postprocess_trajectory</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">worker</span><span class="p">:</span> <span class="s2">&quot;RolloutWorker&quot;</span><span class="p">,</span> <span class="n">episode</span><span class="p">:</span> <span class="n">Episode</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>        <span class="n">agent_id</span><span class="p">:</span> <span class="n">AgentID</span><span class="p">,</span> <span class="n">policy_id</span><span class="p">:</span> <span class="n">PolicyID</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>        <span class="n">policies</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">PolicyID</span><span class="p">,</span> <span class="n">Policy</span><span class="p">],</span> <span class="n">postprocessed_batch</span><span class="p">:</span> <span class="n">SampleBatch</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>        <span class="n">original_batches</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">AgentID</span><span class="p">,</span> <span class="n">SampleBatch</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>    <span class="sd">&quot;&quot;&quot;Called immediately after a policy&#39;s postprocess_fn is called.</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="sd">    You can use this callback to do additional postprocessing for a policy,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">    including looking at the trajectory data of other agents in multi-agent</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">    settings.</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">        worker: Reference to the current rollout worker.</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">        episode: Episode object.</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">        agent_id: Id of the current agent.</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">        policy_id: Id of the current policy for the agent.</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">        policies: Mapping of policy id to policy objects. In single</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">            agent mode there will only be a single &quot;default_policy&quot;.</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">        postprocessed_batch: The postprocessed sample batch</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">            for this agent. You can mutate this object to apply your own</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">            trajectory postprocessing.</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">        original_batches: Mapping of agents to their unpostprocessed</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">            trajectory data. You should not mutate this object.</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">        kwargs: Forward compatibility placeholder.</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_callbacks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;on_postprocess_traj&quot;</span><span class="p">):</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">legacy_callbacks</span><span class="p">[</span><span class="s2">&quot;on_postprocess_traj&quot;</span><span class="p">]({</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>            <span class="s2">&quot;episode&quot;</span><span class="p">:</span> <span class="n">episode</span><span class="p">,</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>            <span class="s2">&quot;agent_id&quot;</span><span class="p">:</span> <span class="n">agent_id</span><span class="p">,</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>            <span class="s2">&quot;pre_batch&quot;</span><span class="p">:</span> <span class="n">original_batches</span><span class="p">[</span><span class="n">agent_id</span><span class="p">],</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>            <span class="s2">&quot;post_batch&quot;</span><span class="p">:</span> <span class="n">postprocessed_batch</span><span class="p">,</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>            <span class="s2">&quot;all_pre_batches&quot;</span><span class="p">:</span> <span class="n">original_batches</span><span class="p">,</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>        <span class="p">})</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.callbacks.DefaultCallbacks.on_sample_end">
<code class="highlight language-python"><span class="n">on_sample_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">worker</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Called at the end of RolloutWorker.sample().</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>worker</code></td>
        <td><code>RolloutWorker</code></td>
        <td><p>Reference to the current rollout worker.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>samples</code></td>
        <td><code>SampleBatch</code></td>
        <td><p>Batch to be returned. You can mutate this
object to modify the samples generated.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>kwargs</code></td>
        <td></td>
        <td><p>Forward compatibility placeholder.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/callbacks.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">def</span> <span class="nf">on_sample_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">worker</span><span class="p">:</span> <span class="s2">&quot;RolloutWorker&quot;</span><span class="p">,</span> <span class="n">samples</span><span class="p">:</span> <span class="n">SampleBatch</span><span class="p">,</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>                  <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span class="sd">&quot;&quot;&quot;Called at the end of RolloutWorker.sample().</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="sd">        worker: Reference to the current rollout worker.</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="sd">        samples: Batch to be returned. You can mutate this</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="sd">            object to modify the samples generated.</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">        kwargs: Forward compatibility placeholder.</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_callbacks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;on_sample_end&quot;</span><span class="p">):</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">legacy_callbacks</span><span class="p">[</span><span class="s2">&quot;on_sample_end&quot;</span><span class="p">]({</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>            <span class="s2">&quot;worker&quot;</span><span class="p">:</span> <span class="n">worker</span><span class="p">,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>            <span class="s2">&quot;samples&quot;</span><span class="p">:</span> <span class="n">samples</span><span class="p">,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>        <span class="p">})</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 class="doc doc-heading" id="ray.rllib.agents.callbacks.DefaultCallbacks.on_train_result">
<code class="highlight language-python"><span class="n">on_train_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">trainer</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Called at the end of Trainable.train().</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>trainer</code></td>
        <td><code>Trainer</code></td>
        <td><p>Current trainer instance.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>result</code></td>
        <td><code>dict</code></td>
        <td><p>Dict of results returned from trainer.train() call.
You can mutate this object to add additional metrics.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>kwargs</code></td>
        <td></td>
        <td><p>Forward compatibility placeholder.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ray/rllib/agents/callbacks.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">def</span> <span class="nf">on_train_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">trainer</span><span class="p">:</span> <span class="s2">&quot;Trainer&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>                    <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span class="sd">&quot;&quot;&quot;Called at the end of Trainable.train().</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="sd">        trainer: Current trainer instance.</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="sd">        result: Dict of results returned from trainer.train() call.</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="sd">            You can mutate this object to add additional metrics.</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">        kwargs: Forward compatibility placeholder.</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_callbacks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;on_train_result&quot;</span><span class="p">):</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">legacy_callbacks</span><span class="p">[</span><span class="s2">&quot;on_train_result&quot;</span><span class="p">]({</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>            <span class="s2">&quot;trainer&quot;</span><span class="p">:</span> <span class="n">trainer</span><span class="p">,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>            <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>        <span class="p">})</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../" class="md-footer__link md-footer__link--prev" aria-label="Previous: Ray RLlib API Reference" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Ray RLlib API Reference
            </div>
          </div>
        </a>
      
      
        
        <a href="../policy/" class="md-footer__link md-footer__link--next" aria-label="Next: Policies" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Policies
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; Anyscale, Inc 2021
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://twitter.com/raydistributed" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://github.com/ray-project/ray" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://ray.io" target="_blank" rel="noopener" title="ray.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.indexes", "content.tabs.link", "navigation.tracking", "navigation.instant", "navigation.top", "content.code.annotate"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.0bbba5b5.min.js", "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.e1a181d9.min.js"></script>
      
        <script src="../../../js/termynal.js"></script>
      
        <script src="../../../js/custom.js"></script>
      
    
  </body>
</html>